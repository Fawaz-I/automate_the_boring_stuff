<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="../assets/automatetheboringstuff.com/3e/style.css" rel="stylesheet" type="text/css" /><title>Chapter 14 - Excel Spreadsheets, Automate the Boring Stuff with Python, 3rd Ed</title></head><body><style>.atbs-nav{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;justify-content:space-between;margin:1rem 0;padding:.7rem .8rem;border:1px solid #cfd8dc;border-radius:10px;background:#f6fbfd;font:14px/1.35 system-ui,-apple-system,sans-serif;}.atbs-nav-center{color:#455a64;font-weight:600;}.atbs-nav-link{text-decoration:none;color:#0b5b6b;background:#e6f3f7;border:1px solid #c7dfe7;border-radius:7px;padding:.42rem .55rem;display:inline-block;}.atbs-nav-link:hover{background:#d9edf3;}.atbs-nav-disabled{opacity:.55;cursor:not-allowed;}</style><nav class='atbs-nav' aria-label='Chapter pagination'><a class='atbs-nav-link' href='../workbook/chapter13.html' aria-label='Previous chapter'>&larr; Workbook Chapter 13</a><span class='atbs-nav-center'><a class='atbs-nav-link' href='../index.html'>Contents</a> Book Chapter 14</span><a class='atbs-nav-link' href='../workbook/chapter14.html' aria-label='Next chapter'>Workbook Chapter 14 &rarr;</a></nav><div type="frontmatter" class="calibre" id="calibre_link-0">




<div type="bodymatter" class="calibre" id="calibre_link-370">
<section type="chapter" role="doc-chapter" aria-labelledby="ch14">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1142" aria-label="331"></span>
<hgroup>
<h2 class="title" id="calibre_link-1828">
<span class="tpt"><span class="sans_dogma_ot_bold_b_">14</span></span>
<span class="ct"><span class="sans_dogma_ot_bold_b_">EXCEL SPREADSHEETS</span></span>
</h2>
</hgroup>
<figure class="opener"><img class="opener1" src="../assets/automatetheboringstuff.com/3e/images/000112.jpg" role="presentation" alt="" />
</figure>
<p class="introtni">Although we don’t often think of spreadsheets as programming tools, almost everyone uses them to organize information into two-dimensional data structures, perform calculations with formulas, and produce output as charts. In the next two chapters, we’ll integrate Python into two popular spreadsheet applications: Microsoft Excel and Google Sheets.</p>
<p class="tx">Excel is a popular and powerful spreadsheet application. The <span class="thesansmonocd_w5regular_">openpyxl</span> module allows your Python programs to read and modify Excel spreadsheet files. For example, you might have the boring task of copying certain data from one spreadsheet and pasting it into another one. Or you might have to go through thousands of rows and pick out just a handful of them to make small edits based on some criteria. Or you might have to look through hundreds of spreadsheets of department budgets, searching for any that are in <span role="doc-pagebreak" type="pagebreak" id="calibre_link-1000" aria-label="332"></span>the red. These are exactly the sorts of boring, mindless spreadsheet tasks that Python can do for you.</p>
<p class="tx">Although Excel is proprietary software from Microsoft, LibreOffice is a free alternative that runs on Windows, macOS, and Linux. LibreOffice Calc uses Excel’s <i class="calibre5">.xlsx</i> file format for spreadsheets, which means the <span class="thesansmonocd_w5regular_">openpyxl</span> module can work on spreadsheets from this application as well. You can download it from <i class="calibre5"><a href="https://www.libreoffice.org" class="calibre1">https://<wbr></wbr>www<wbr></wbr>.libreoffice<wbr></wbr>.org</a></i>. Even if you already have Excel installed on your computer, you may find this program easier to use. The screenshots in this chapter, however, are all from the cloud-based Office 365 Excel.</p>
<p class="tx">The <span class="thesansmonocd_w5regular_">openpyxl</span> module operates on Excel files, and not the desktop Excel application or cloud-based Excel web app. If you’re using the cloud-based Office 365, you must click <b class="calibre10">File</b><span class="listbullet_menuarrow"></span><b class="calibre10">Save As</b><span class="listbullet_menuarrow"></span><b class="calibre10">Download a Copy</b> to download a spreadsheet, run your Python script to edit the spreadsheet file, and then re-upload the spreadsheet to Office 365 to see the changes. If you have the desktop Excel application, you must close the spreadsheet, run your Python script to edit the spreadsheet file, and then reopen it in Excel to see the changes.</p>
<p class="tx">Python does not come with <span class="thesansmonocd_w5regular_">openpyxl</span>, so you’ll have to install it. <span>Appendix A</span> has information on how to install third-party packages with Python’s pip tool. You can find the full <span class="thesansmonocd_w5regular_">openpyxl</span> documentation at <i class="calibre5"><a href="https://openpyxl.readthedocs.io/en/stable/" class="calibre1">https://<wbr></wbr>openpyxl<wbr></wbr>.readthedocs<wbr></wbr>.io<wbr></wbr>/en<wbr></wbr>/stable<wbr></wbr>/</a></i>.</p>
<p class="tx">You’ll use several example spreadsheet files in this chapter. You can download them from the book’s online materials at <i class="calibre5"><a href="https://nostarch.com/automate-boring-stuff-python-3rd-edition" class="calibre1">https://<wbr></wbr>nostarch<wbr></wbr>.com<wbr></wbr>/automate<wbr></wbr>-boring<wbr></wbr>-stuff<wbr></wbr>-python<wbr></wbr>-3rd<wbr></wbr>-edition</a></i>.</p>
<section type="division" aria-labelledby="sec1">
<h3 class="h" id="calibre_link-1829"><span id="calibre_link-371"></span><span class="sans_futura_std_bold_b_">Reading Excel Files</span></h3>
<p class="tni">First, let’s go over some basic definitions. An Excel spreadsheet document is called a <i class="calibre5">workbook</i>. A single workbook is saved in a file with the <i class="calibre5">.xlsx</i> extension.</p>
<p class="tx">Each workbook can contain multiple <i class="calibre5">sheets</i> (also called <i class="calibre5">worksheets</i>). The sheet the user is currently viewing (or last viewed before closing Excel) is called the <i class="calibre5">active sheet</i>. Each sheet has <i class="calibre5">columns</i> (addressed by letters starting at <i class="calibre5">A</i>) and <i class="calibre5">rows</i> (addressed by numbers starting at 1). A box at a particular column and row is called a <i class="calibre5">cell</i>. Each cell can contain a number or text value. The grid of cells and their data makes up a sheet.</p>
<p class="tx">The examples in this chapter will use a spreadsheet named <i class="calibre5">example3.xlsx</i> stored in the current working directory. You can either create the spreadsheet yourself or download it from this book’s online resources. Figure 14-1 shows the tabs for the three sheets named <i class="calibre5">Sheet1</i>, <i class="calibre5">Sheet2</i>, and <i class="calibre5">Sheet3</i>.</p>
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1226" aria-label="333"></span>
<figure class="img"><img class="img2" id="calibre_link-756" src="../assets/automatetheboringstuff.com/3e/images/000017.jpg" alt="The bottom of an Excel file listing the tabs “Sheet 1”, “Sheet 2”, and “Sheet 3”. Sheet 1 is highlighted and open to a blank spreadsheet." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-1: The tabs for a workbook’s sheets are in the lower-left corner of Excel.</span></p></figcaption>
</figure>
<p class="tx"><i class="calibre5">Sheet1</i> in the example file should look like Table 14-1. (If you didn’t download <i class="calibre5">example3.xlsx</i>, you should enter this data into the sheet yourself.)</p>
<table class="basic-table">
<caption class="calibre12"><p class="tt" id="calibre_link-757"><span class="sans_futura_std_bold_b_"><span class="sans_futura_std_bold_b_">Table 14-1:</span></span> <span class="sans_futura_std_book_">The</span> <span class="sans_futura_std_book_oblique_i_">example3.xlsx</span> <span class="sans_futura_std_book_">Spreadsheet</span></p></caption>

<thead class="calibre13">
<tr class="calibre14">
<td class="tch2"></td>
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">A</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">B</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">C</span></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="calibre16">
<td class="tbf"><p class="tch1"><span class="sans_futura_std_bold_b_">1</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">4/5/2035 1:34:02 PM</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">Apples</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">73</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="sans_futura_std_bold_b_">2</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">4/5/2035 3:41:23 AM</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Cherries</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">85</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="sans_futura_std_bold_b_">3</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">4/6/2035 12:46:51 PM</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Pears</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">14</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="sans_futura_std_bold_b_">4</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">4/8/2035 8:59:43 AM</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Oranges</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">52</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="sans_futura_std_bold_b_">5</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">4/10/2035 2:07:00 AM</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Apples</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">152</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="sans_futura_std_bold_b_">6</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">4/10/2035 6:10:37 PM</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Bananas</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">23</span></p></td>
</tr>
<tr class="calibre16">
<td class="tbl"><p class="tch1"><span class="sans_futura_std_bold_b_">7</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">4/10/2035 2:40:46 AM</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">Strawberries</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">98</span></p></td>
</tr>
</tbody>
</table>
<p class="tx">Now that we have our example spreadsheet, let’s see how we can manipulate it with the <span class="thesansmonocd_w5regular_">openpyxl</span> module.</p>
<section type="division" aria-labelledby="sec2">
<h4 class="h1" id="calibre_link-1830"><span id="calibre_link-372"></span><span class="sans_futura_std_heavy_oblique_bi_">Opening a Workbook</span></h4>
<p class="tni">Once you’ve imported the <span class="thesansmonocd_w5regular_">openpyxl</span> module, you’ll be able to open <i class="calibre5">.xlsx</i> files with the <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span> function. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">type(wb)</b>
&lt;class 'openpyxl.workbook.workbook.Workbook'&gt;
</code></pre>
<p class="tx">The <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span> function takes in the filename and returns a value of the <span class="thesansmonocd_w5regular_">Workbook</span> data type. This <span class="thesansmonocd_w5regular_">Workbook</span> object represents the Excel file, a bit like how a <span class="thesansmonocd_w5regular_">File</span> object represents an opened text file.</p>
</section>
<section type="division" aria-labelledby="sec3">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-882" aria-label="334"></span>
<h4 class="h1" id="calibre_link-1831"><span id="calibre_link-373"></span><span class="sans_futura_std_heavy_oblique_bi_">Getting Sheets from the Workbook</span></h4>
<p class="tni">You can get a list of all the sheet names in the workbook by accessing the <span class="thesansmonocd_w5regular_">sheetnames</span> attribute. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames  </b># The workbook's sheets' names
['Sheet1', 'Sheet2', 'Sheet3']
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet3']  </b># Get a sheet from the workbook.
&gt;&gt;&gt; <b class="calibre10">sheet</b>
&lt;Worksheet "Sheet3"&gt;
&gt;&gt;&gt; <b class="calibre10">type(sheet)</b>
&lt;class 'openpyxl.worksheet.worksheet.Worksheet'&gt;
&gt;&gt;&gt; <b class="calibre10">sheet.title  </b># Get the sheet's title as a string.
'Sheet3'
&gt;&gt;&gt; <b class="calibre10">another_sheet = wb.active  </b># Get the active sheet.
&gt;&gt;&gt; <b class="calibre10">another_sheet</b>
&lt;Worksheet "Sheet1"&gt;
</code></pre>
<p class="tx">Each sheet is represented by a <span class="thesansmonocd_w5regular_">Worksheet</span> object, which you can obtain by using the square brackets with the sheet name string, like a dictionary key. Finally, you can use the <span class="thesansmonocd_w5regular_">active</span> attribute of a <span class="thesansmonocd_w5regular_">Workbook</span> object to get the workbook’s active sheet. The active sheet is the sheet that’s on top when the workbook is opened in Excel. Once you have the <span class="thesansmonocd_w5regular_">Worksheet</span> object, you can get its name from the <span class="thesansmonocd_w5regular_">title</span> attribute.</p>
</section>
<section type="division" aria-labelledby="sec4">
<h4 class="h1" id="calibre_link-1832"><span id="calibre_link-374"></span><span class="sans_futura_std_heavy_oblique_bi_">Getting Cells from the Sheets</span></h4>
<p class="tni">Once you have a <span class="thesansmonocd_w5regular_">Worksheet</span> object, you can access a <span class="thesansmonocd_w5regular_">Cell</span> object by its name. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']  </b># Get a sheet from the workbook.
&gt;&gt;&gt; <b class="calibre10">sheet['A1']  </b># Get a cell from the sheet.
&lt;Cell 'Sheet1'.A1&gt;
&gt;&gt;&gt; <b class="calibre10">sheet['A1'].value  </b># Get the value from the cell.
datetime.datetime(2035, 4, 5, 13, 34, 2)
&gt;&gt;&gt; <b class="calibre10">c = sheet['B1']  </b># Get another cell from the sheet.
&gt;&gt;&gt; <b class="calibre10">c.value</b>
'Apples'
&gt;&gt;&gt;  # Get the row, column, and value from the cell.
&gt;&gt;&gt; <b class="calibre10">f'Row {c.row}, Column {c.column} is {c.value}'</b>
'Row 1, Column 2 is Apples'
&gt;&gt;&gt; <b class="calibre10">f'Cell {c.coordinate} is {c.value}'</b>
'Cell B1 is Apples'
&gt;&gt;&gt; <b class="calibre10">sheet['C1'].value</b>
73
</code></pre>
<p class="tx">The <span class="thesansmonocd_w5regular_">Cell</span> object has a <span class="thesansmonocd_w5regular_">value</span> attribute that contains, unsurprisingly, the value stored in that cell. It also has <span class="thesansmonocd_w5regular_">row</span>, <span class="thesansmonocd_w5regular_">column</span>, and <span class="thesansmonocd_w5regular_">coordinate</span> attributes that provide location information for the cell. Here, accessing the <span class="thesansmonocd_w5regular_">value</span> attribute <span role="doc-pagebreak" type="pagebreak" id="calibre_link-1095" aria-label="335"></span>of our <span class="thesansmonocd_w5regular_">Cell</span> object for cell B1 gives us the string <span class="thesansmonocd_w5regular_">'Apples'</span>. The <span class="thesansmonocd_w5regular_">row</span> attribute gives us the integer <span class="thesansmonocd_w5regular_">1</span>, the <span class="thesansmonocd_w5regular_">column</span> attribute gives us <span class="thesansmonocd_w5regular_">2</span>, and the <span class="thesansmonocd_w5regular_">coordinate</span> attribute gives us <span class="thesansmonocd_w5regular_">'B1'</span>.</p>
<p class="tx">The <span class="thesansmonocd_w5regular_">openpyxl</span> module will automatically interpret the dates in column A and return them as <span class="thesansmonocd_w5regular_">datetime</span> values rather than strings. <span>Chapter 19</span> explains the <span class="thesansmonocd_w5regular_">datetime</span> data type further.</p>
<p class="tx">Specifying a column by letter can be tricky to program, especially because after column Z, the columns start using two letters: AA, AB, AC, and so on. As an alternative, you can also get a cell using the sheet’s <span class="thesansmonocd_w5regular_">cell()</span> method and passing integers for its <span class="thesansmonocd_w5regular_">row</span> and <span class="thesansmonocd_w5regular_">column</span> keyword arguments. The first row or column integer is 1, not 0. Continue the interactive shell example by entering the following:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">sheet.cell(row=1, column=2)</b>
&lt;Cell 'Sheet1'.B1&gt;
&gt;&gt;&gt; <b class="calibre10">sheet.cell(row=1, column=2).value</b>
'Apples'
&gt;&gt;&gt; <b class="calibre10">for i in range(1, 8, 2): </b># Go through every other row.
<b class="calibre10">...     print(i, sheet.cell(row=i, column=2).value)</b>
...
1 Apples
3 Pears
5 Apples
7 Strawberries
</code></pre>
<p class="tx">Using the sheet’s <span class="thesansmonocd_w5regular_">cell()</span> method and passing it <span class="thesansmonocd_w5regular_">row=1</span> and <span class="thesansmonocd_w5regular_">column=2</span> gets you a <span class="thesansmonocd_w5regular_">Cell</span> object for cell B1, just like specifying <span class="thesansmonocd_w5regular_">sheet['B1']</span> did.</p>
<p class="tx">By using this <span class="thesansmonocd_w5regular_">cell()</span> method and its keyword arguments, we wrote a <span class="thesansmonocd_w5regular_">for</span> loop to print the values of a series of cells. Say you want to go down column B and print the value in every cell with an odd row number. By passing <span class="thesansmonocd_w5regular_">2</span> for the <span class="thesansmonocd_w5regular_">range()</span> function’s “step” parameter, you can get cells from every second row (in this case, all the odd-numbered rows). This example passes the <span class="thesansmonocd_w5regular_">for</span> loop’s <span class="thesansmonocd_w5regular_">i</span> variable as the <span class="thesansmonocd_w5regular_">cell()</span> method’s <span class="thesansmonocd_w5regular_">row</span> keyword argument, and uses <span class="thesansmonocd_w5regular_">2</span> for the <span class="thesansmonocd_w5regular_">column</span> keyword argument on each call of the method. Note that this method accepts the integer <span class="thesansmonocd_w5regular_">2</span>, not the string <span class="thesansmonocd_w5regular_">'B'</span>.</p>
<p class="tx">You can determine the size of the sheet with the <span class="thesansmonocd_w5regular_">Worksheet</span> object’s <span class="thesansmonocd_w5regular_">max_row</span> and <span class="thesansmonocd_w5regular_">max_column</span> attributes. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">sheet.max_row  </b># Get the highest row number.
7
&gt;&gt;&gt; <b class="calibre10">sheet.max_column  </b># Get the highest column number.
3
</code></pre>
<p class="tx">Note that the <span class="thesansmonocd_w5regular_">max_column</span> attribute is an integer rather than the letter that appears in Excel.</p>
</section>
<section type="division" aria-labelledby="sec5">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1035" aria-label="336"></span>
<h4 class="h1" id="calibre_link-1833"><span id="calibre_link-375"></span><span class="sans_futura_std_heavy_oblique_bi_">Converting Between Column Letters and Numbers</span></h4>
<p class="tni">To convert from numbers to letters, call the <span class="thesansmonocd_w5regular_">openpyxl.utils.get_column_letter()</span> function. To convert from letters to numbers, call the <span class="thesansmonocd_w5regular_">openpyxl.utils.column_index_from_string()</span> function. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">from openpyxl.utils import get_column_letter, column_index_from_string</b>
&gt;&gt;&gt; <b class="calibre10">get_column_letter(1)</b>  # Translate column 1 to a letter.
'A'
&gt;&gt;&gt; <b class="calibre10">get_column_letter(2</b>)
'B'
&gt;&gt;&gt; <b class="calibre10">get_column_letter(27)</b>
'AA'
&gt;&gt;&gt; <b class="calibre10">get_column_letter(900)</b>
'AHP'
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">get_column_letter(sheet.max_column)</b>
'C'
&gt;&gt;&gt; <b class="calibre10">column_index_from_string('A')</b> # Get A's number.
1
&gt;&gt;&gt; <b class="calibre10">column_index_from_string('AA')</b>
27
</code></pre>
<p class="tx">After you import these two functions from the <span class="thesansmonocd_w5regular_">openpyxl.utils</span> module, you can call <span class="thesansmonocd_w5regular_">get_column_letter()</span> and pass it an integer like <span class="thesansmonocd_w5regular_">27</span> to figure out what the letter name of the 27th column is. The function <span class="thesansmonocd_w5regular_">column_index_from_string()</span> does the reverse: you pass it the letter name of a column, and it tells you what number that column is. You don’t need to have a workbook loaded to use these functions.</p>
</section>
<section type="division" aria-labelledby="sec6">
<h4 class="h1" id="calibre_link-1834"><span id="calibre_link-376"></span><span class="sans_futura_std_heavy_oblique_bi_">Getting Rows and Columns</span></h4>
<p class="tni">You can slice <span class="thesansmonocd_w5regular_">Worksheet</span> objects to get all the <span class="thesansmonocd_w5regular_">Cell</span> objects in a row, column, or rectangular area of the spreadsheet. Then, you can loop over all the cells in the slice. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1':'C3']  </b># Get cells A1 to C3.
((&lt;Cell 'Sheet1'.A1&gt;, &lt;Cell 'Sheet1'.B1&gt;, &lt;Cell 'Sheet1'.C1&gt;), (&lt;Cell 'Sheet1'.A2&gt;, &lt;Cell
'Sheet1'.B2&gt;, &lt;Cell 'Sheet1'.C2&gt;), (&lt;Cell 'Sheet1'.A3&gt;, &lt;Cell 'Sheet1'.B3&gt;, &lt;Cell
'Sheet1'.C3&gt;))
&gt;&gt;&gt; <b class="calibre10">for row_of_cell_objects in sheet['A1':'C3']:</b> <span class="code_codeannotation" aria-label="annotation1">❶</span>
<b class="calibre10">...     for cell_obj in row_of_cell_objects:</b> <span class="code_codeannotation" aria-label="annotation2">❷</span>
<b class="calibre10">...         print(cell_obj.coordinate, cell_obj.value)</b>
<b class="calibre10">...     print('--- END OF ROW ---')</b>
...
A1 2035-04-05 13:34:02
B1 Apples
C1 73
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1835" aria-label="337"></span><b class="calibre10">--- </b>END OF ROW <b class="calibre10">---</b>
A2 2035-04-05 03:41:23
B2 Cherries
C2 85
<b class="calibre10">--- </b>END OF ROW <b class="calibre10">---</b>
A3 2035-04-06 12:46:51
B3 Pears
C3 14
<b class="calibre10">--- </b>END OF ROW <b class="calibre10">---</b>
</code></pre>
<p class="tx">Here, we specify <span class="thesansmonocd_w5regular_">['A1':'C3']</span> to get a slice of the <span class="thesansmonocd_w5regular_">Cell</span> objects in the rectangular area from A1 to C3, and we get a tuple containing the <span class="thesansmonocd_w5regular_">Cell</span> objects in that area.</p>
<p class="tx">This tuple contains three tuples: one for each row, from the top of the desired area to the bottom. Each of these three inner tuples contains the <span class="thesansmonocd_w5regular_">Cell</span> objects in one row of our desired area, from the leftmost cell to the rightmost. So, overall, our slice of the sheet contains all the <span class="thesansmonocd_w5regular_">Cell</span> objects in the area from A1 to C3, starting from the top-left cell and ending with the bottom-right cell.</p>
<p class="tx">To print the values of each cell in the area, we use two <span class="thesansmonocd_w5regular_">for</span> loops. The outer <span class="thesansmonocd_w5regular_">for</span> loop goes over each row in the slice <span class="codeannotation" aria-label="annotation1">❶</span>. Then, for each row, the nested <span class="thesansmonocd_w5regular_">for</span> loop goes through each cell in that row <span class="codeannotation" aria-label="annotation2">❷</span>.</p>
<p class="tx">To access the values of cells in a particular row or column, you can also use a <span class="thesansmonocd_w5regular_">Worksheet</span> object’s <span class="thesansmonocd_w5regular_">rows</span> and <span class="thesansmonocd_w5regular_">columns</span> attributes. These attributes must be converted to lists with the <span class="thesansmonocd_w5regular_">list()</span> function before you can use the square brackets and an index with them. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">list(sheet.columns)[1]  </b># Get the second column's cells.
(&lt;Cell 'Sheet1'.B1&gt;, &lt;Cell 'Sheet1'.B2&gt;, &lt;Cell 'Sheet1'.B3&gt;, &lt;Cell 'Sheet1'.B4&gt;, &lt;Cell
'Sheet1'.B5&gt;, &lt;Cell 'Sheet1'.B6&gt;, &lt;Cell 'Sheet1'.B7&gt;)
&gt;&gt;&gt; <b class="calibre10">for cell_obj in list(sheet.columns)[1]:</b>
...     <b class="calibre10">print(cell_obj.value)</b>
...
Apples
Cherries
Pears
Oranges
Apples
Bananas
Strawberries
</code></pre>
<p class="tx">Using the <span class="thesansmonocd_w5regular_">rows</span> attribute on a <span class="thesansmonocd_w5regular_">Worksheet</span> object, passed to <span class="thesansmonocd_w5regular_">list()</span>, will give us a list of tuples. Each of these tuples represents a row and contains the <span class="thesansmonocd_w5regular_">Cell</span> objects in that row. The <span class="thesansmonocd_w5regular_">columns</span> attribute, passed to <span class="thesansmonocd_w5regular_">list()</span>, also gives us a list of tuples, with each of the tuples containing the <span class="thesansmonocd_w5regular_">Cell</span> objects in a particular column. For <i class="calibre5">example3.xlsx</i>, because there are seven rows and three columns, <span class="thesansmonocd_w5regular_">list(sheet.rows)</span> gives us a list of seven tuples (each containing <span role="doc-pagebreak" type="pagebreak" id="calibre_link-1003" aria-label="338"></span>three <span class="thesansmonocd_w5regular_">Cell</span> objects), and <span class="thesansmonocd_w5regular_">list(sheet</span>.<span class="thesansmonocd_w5regular_">columns)</span> gives us a list of three tuples (each containing seven <span class="thesansmonocd_w5regular_">Cell</span> objects).</p>
<p class="tx">To access one particular tuple, you can refer to it by its index in the larger tuple. For example, to get the tuple that represents column B, you’d use <span class="thesansmonocd_w5regular_">list(sheet.columns)[1]</span>. To get the tuple containing the <span class="thesansmonocd_w5regular_">Cell</span> objects in column A, you’d use <span class="thesansmonocd_w5regular_">list(sheet.columns)[0]</span>. Once you have a tuple representing one row or column, you can loop through its <span class="thesansmonocd_w5regular_">Cell</span> objects and print their values.</p>
<aside class="box" aria-label="box-17">
<p class="bt" id="calibre_link-1836"><span class="sans_futura_std_bold_b_">A REVIEW OF WORKBOOKS, SHEETS, AND CELLS</span></p>
<p class="btni"><span class="sans_futura_std_book_">As a quick review, here’s a rundown of all the functions, methods, and data types involved in reading a cell out of a spreadsheet file:</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">1.  Import the</span> <span class="thesansmonocd_w5regular_">openpyxl</span> <span class="sans_futura_std_book_">module.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">2.  Call the</span> <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span> <span class="sans_futura_std_book_">function to get a</span> <span class="thesansmonocd_w5regular_">Workbook</span> <span class="sans_futura_std_book_">object.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">3.  Use the</span> <span class="thesansmonocd_w5regular_">active</span> <span class="sans_futura_std_book_">or</span> <span class="thesansmonocd_w5regular_">sheetnames</span> <span class="sans_futura_std_book_">attribute.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">4.  Get a</span> <span class="thesansmonocd_w5regular_">Worksheet</span> <span class="sans_futura_std_book_">object.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">5.  Use indexing or the</span> <span class="thesansmonocd_w5regular_">cell()</span> <span class="sans_futura_std_book_">sheet method with</span> <span class="thesansmonocd_w5regular_">row</span> <span class="sans_futura_std_book_">and</span> <span class="thesansmonocd_w5regular_">column</span> <span class="sans_futura_std_book_">keyword arguments.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">6.  Get a</span> <span class="thesansmonocd_w5regular_">Cell</span> <span class="sans_futura_std_book_">object.</span></p>
<p class="boxlistnumber"><span class="sans_futura_std_book_">7.  Read the</span> <span class="thesansmonocd_w5regular_">Cell</span> <span class="sans_futura_std_book_">object’s</span> <span class="thesansmonocd_w5regular_">value</span> <span class="sans_futura_std_book_">attribute.</span></p>
</aside>
<p class="ph"><span id="calibre_link-377"></span><span class="sans_futura_std_heavy_b_">Project 9: Gather Census Statistics</span></p>
<p class="tni">Say you have a spreadsheet of data from the 2010 US Census and you’ve been given the boring task of going through its thousands of rows to count both the population and the number of census tracts for each county. (A <i class="calibre5">census tract</i> is simply a geographic area defined for the purposes of the census.) Each row represents a single census tract. We’ll name the spreadsheet file <i class="calibre5">censuspopdata.xlsx</i>, and you can download it from this book’s online resources. Its contents look like Figure 14-2.</p>
<figure class="img"><img class="img2" id="calibre_link-758" src="../assets/automatetheboringstuff.com/3e/images/000020.jpg" alt="An Excel spreadsheet with the columns “CensusTract”, “State”, “County”, and “POP2010”. Each row contains details about a census tract in San Francisco." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-2: The</span> <span class="sans_futura_std_book_">censuspopdata.xlsx</span> <span class="sans_futura_std_book_oblique_i_">spreadsheet</span></p></figcaption>
</figure>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1282" aria-label="339"></span>Even though Excel can automatically calculate the sum of multiple selected cells, you’d still have to first manually select the cells for each of the 3,000-plus counties. Even if it takes just a few seconds to calculate a county’s population by hand, this would take hours to do for the whole spreadsheet.</p>
<p class="tx">In this project, you’ll write a script that can read from the census spreadsheet file and calculate statistics for each county in a matter of seconds.</p>
<p class="tx">This is what your program does:</p>
<ul class="ul">
<li class="bl">Reads the data from the Excel spreadsheet</li>
<li class="bl">Counts the number of census tracts in each county</li>
<li class="bl">Counts the total population of each county</li>
<li class="bl">Prints the results</li>
</ul>
<p class="tx">This means your code will need to do the following:</p>
<ul class="ul">
<li class="bl">Open and read the cells of an Excel document with the <span class="thesansmonocd_w5regular_">openpyxl</span> module.</li>
<li class="bl">Calculate all the tract and population data and store it in a data structure.</li>
<li class="bl">Write the data structure to a text file with the <i class="calibre5">.py</i> extension using the <span class="thesansmonocd_w5regular_">pprint</span> module so that it can be imported later.</li>
</ul>
</section>
<section type="division" aria-labelledby="sec7">
<h4 class="h1" id="calibre_link-1837"><span id="calibre_link-378"></span><span class="sans_futura_std_heavy_oblique_bi_">Step 1: Read the Spreadsheet Data</span></h4>
<p class="tni">There is just one sheet in the <i class="calibre5">censuspopdata.xlsx</i> spreadsheet, named <span class="thesansmonocd_w5regular_">'Population by Census Tract'</span>, and each row in the sheet holds the data for a single census tract. The columns are the tract number (A), the state abbreviation (B), the county name (C), and the population of the tract (D).</p>
<p class="tx">Open a new file editor tab and enter the following code, then save the file as <i class="calibre5">readCensusExcel.py</i>:</p>
<pre class="pre"><code class="calibre9"># readCensusExcel.py - Tabulates county population and census tracts

<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> import openpyxl, pprint
print('Opening workbook...')
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> wb = openpyxl.load_workbook('censuspopdata.xlsx')
<span class="codeannotated_codeannotation" aria-label="annotation3">❸</span> sheet = wb['Population by Census Tract']
county_data = {}

# TODO: Fill in county_data with each county's population and tracts.
print('Reading rows...')
<span class="codeannotated_codeannotation" aria-label="annotation4">❹</span> for row in range(2, sheet.max_row + 1):
    # Each row in the spreadsheet has data for one census tract.
    state  = sheet['B' + str(row)].value
    county = sheet['C' + str(row)].value
    pop    = sheet['D' + str(row)].value

# TODO: Open a new text file and write the contents of county_data to it.
</code></pre>
<p class="tx">This code imports the <span class="thesansmonocd_w5regular_">openpyxl</span> module, as well as the <span class="thesansmonocd_w5regular_">pprint</span> module that you’ll use to print the final county data <span class="codeannotation" aria-label="annotation1">❶</span>. Then, it opens the <span role="doc-pagebreak" type="pagebreak" id="calibre_link-1838" aria-label="340"></span><i class="calibre5">censuspopdata.xlsx</i> file <span class="codeannotation" aria-label="annotation2">❷</span>, gets the sheet with the census data <span class="codeannotation" aria-label="annotation3">❸</span>, and begins iterating over its rows <span class="codeannotation" aria-label="annotation4">❹</span>.</p>
<p class="tx">Note that you’ve also created a variable named <span class="thesansmonocd_w5regular_">county_data</span>, which will contain the populations and number of tracts you calculate for each county. Before you can store anything in it, though, you should determine exactly how you’ll structure the data inside it.</p>
</section>
<section type="division" aria-labelledby="sec8">
<h4 class="h1" id="calibre_link-1839"><span id="calibre_link-379"></span><span class="sans_futura_std_heavy_oblique_bi_">Step 2: Populate the Data Structure</span></h4>
<p class="tni">In the United States, states have two-letter abbreviations and are further split into counties. The data structure stored in <span class="thesansmonocd_w5regular_">county_data</span> will be a dictionary with state abbreviations as its keys. Each state abbreviation will map to another dictionary, whose keys are strings of the county names in that state. Each county name will in turn map to a dictionary with just two keys, <span class="thesansmonocd_w5regular_">'tracts'</span> and <span class="thesansmonocd_w5regular_">'pop'</span>. These keys map to the number of census tracts and the population for the county. For example, the dictionary will look similar to this:</p>
<pre class="pre"><code class="calibre9">{'AK': {'Aleutians East': {'pop': 3141, 'tracts': 1},
        'Aleutians West': {'pop': 5561, 'tracts': 2},
        'Anchorage': {'pop': 291826, 'tracts': 55},
        'Bethel': {'pop': 17013, 'tracts': 3},
        'Bristol Bay': {'pop': 997, 'tracts': 1},
        <span class="sans_thesansmonocd_w5regular_italic_">--snip--</span>
</code></pre>
<p class="tx">If the previous dictionary were stored in <span class="thesansmonocd_w5regular_">county_data</span>, the following expressions would evaluate like this:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">county_data['AK']['Anchorage']['pop']</b>
291826
&gt;&gt;&gt; <b class="calibre10">county_data['AK']['Anchorage']['tracts']</b>
55
</code></pre>
<p class="tx">More generally, the <span class="thesansmonocd_w5regular_">county_data</span> dictionary’s keys will look like this:</p>
<pre class="pre"><code class="calibre9">county_data[<var class="calibre20">state abbrev</var>][<var class="calibre20">county</var>]['tracts']
county_data[<var class="calibre20">state abbrev</var>][<var class="calibre20">county</var>]['pop']
</code></pre>
<p class="tx">Now that you know how <span class="thesansmonocd_w5regular_">county_data</span> will be structured, you can write the code that will fill it with the county data. Add the following code to the bottom of your program:</p>
<pre class="pre"><code class="calibre9"># readCensusExcel.py - Tabulates county population and census tracts

<var class="calibre20">--snip--</var>

for row in range(2, sheet.max_row + 1):
    # Each row in the spreadsheet has data for one census tract.
    state  = sheet['B' + str(row)].value
    county = sheet['C' + str(row)].value
    pop    = sheet['D' + str(row)].value

<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1109" aria-label="341"></span><b class="calibre10">    # Make sure the key for this state exists.</b>
<b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation1">❶</span><b class="calibre10"> county_data.setdefault(state, {})</b>
<b class="calibre10">    # Make sure the key for this county in this state exists.</b>
<b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation2">❷</span><b class="calibre10"> county_data[state].setdefault(county, {'tracts': 0, 'pop': 0})</b>

<b class="calibre10">    # Each row represents one census tract, so increment by one.</b>
<b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation3">❸</span><b class="calibre10"> county_data[state][county]['tracts'] += 1</b>
<b class="calibre10">    # Increase the county pop by the pop in this census tract.</b>
<b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation4">❹</span><b class="calibre10"> county_data[state][county]['pop'] += int(pop)</b>

# TODO: Open a new text file and write the contents of county_data to it.
</code></pre>
<p class="tx">The last two lines of code perform the actual calculation work, incrementing the value for <span class="thesansmonocd_w5regular_">tracts</span> <span class="codeannotation" aria-label="annotation3">❸</span> and increasing the value for <span class="thesansmonocd_w5regular_">pop</span> <span class="codeannotation" aria-label="annotation4">❹</span> for the current county on each iteration of the <span class="thesansmonocd_w5regular_">for</span> loop.</p>
<p class="tx">The other code is there because you cannot add a county dictionary as the value for a state abbreviation key until the key itself exists in <span class="thesansmonocd_w5regular_">county_data</span>. (That is, <span class="thesansmonocd_w5regular_">county_data['AK']['Anchorage']['tracts']</span> <span class="thesansmonocd_w5regular_">+=</span> <span class="thesansmonocd_w5regular_">1</span> will cause an error if the '<span class="thesansmonocd_w5regular_">AK'</span> key doesn’t exist yet.) To make sure the state abbreviation key exists in your data structure, you need to call the <span class="thesansmonocd_w5regular_">setdefault()</span> method to set a value if one does not already exist for <span class="thesansmonocd_w5regular_">state</span> <span class="codeannotation" aria-label="annotation1">❶</span>.</p>
<p class="tx">Just as the <span class="thesansmonocd_w5regular_">county_data</span> dictionary needs a dictionary as the value for each state abbreviation key, each of <i class="calibre5">those</i> dictionaries will need its own dictionary as the value for each county key <span class="codeannotation" aria-label="annotation2">❷</span>. And each of <i class="calibre5">those</i> dictionaries in turn will need the keys <span class="thesansmonocd_w5regular_">'tracts'</span> and <span class="thesansmonocd_w5regular_">'pop'</span> that start with the integer value <span class="thesansmonocd_w5regular_">0</span>. (If you ever lose track of the dictionary structure, look back at the example dictionary at the start of this section.)</p>
<p class="tx">Since <span class="thesansmonocd_w5regular_">setdefault()</span> will do nothing if the key already exists, you can call it on every iteration of the <span class="thesansmonocd_w5regular_">for</span> loop without a problem.</p>
</section>
<section type="division" aria-labelledby="sec9">
<h4 class="h1" id="calibre_link-1840"><span id="calibre_link-380"></span><span class="sans_futura_std_heavy_oblique_bi_">Step 3: Write the Results to a File</span></h4>
<p class="tni">After the <span class="thesansmonocd_w5regular_">for</span> loop has finished, the <span class="thesansmonocd_w5regular_">county_data</span> dictionary will contain all of the population and tract information keyed by county and state. At this point, you could program more code to write this data to a text file or another Excel spreadsheet. For now, let’s just use the <span class="thesansmonocd_w5regular_">pprint.pformat()</span> function to write the <span class="thesansmonocd_w5regular_">county_data</span> dictionary value as a massive string to a file named <i class="calibre5">census2010.py</i>. Add the following code to the bottom of your program (making sure to keep it un-indented so that it stays outside the <span class="thesansmonocd_w5regular_">for</span> loop):</p>
<pre class="pre"><code class="calibre9"># readCensusExcel.py - Tabulates county population and census tracts.

<var class="calibre20">--snip--</var>

<b class="calibre10"># Open a new text file and write the contents of county_data to it.</b>
<b class="calibre10">print('Writing results...')</b>
<b class="calibre10">result_file = open('census2010.py', 'w')</b>
<b class="calibre10">result_file.write('allData = ' + pprint.pformat(county_data))</b>
<b class="calibre10">result_file.close()</b>
<b class="calibre10">print('Done.')</b>
</code></pre>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1002" aria-label="342"></span>The <span class="thesansmonocd_w5regular_">pprint.pformat()</span> function produces a string that itself is formatted as valid Python code. By outputting it to a text file named <i class="calibre5">census2010.py</i>, you’ve generated a Python program from your Python program! This may seem complicated, but the advantage is that you can now import <i class="calibre5">census2010.py</i> just like any other Python module. In the interactive shell, change the current working directory to the folder with your newly created <i class="calibre5">census2010.py</i> file and then import it:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import census2010</b>
&gt;&gt;&gt; <b class="calibre10">census2010.allData['AK']['Anchorage']</b>
{'pop': 291826, 'tracts': 55}
&gt;&gt;&gt; <b class="calibre10">anchorage_pop = census2010.allData['AK']['Anchorage']['pop']</b>
&gt;&gt;&gt; <b class="calibre10">print('The 2010 population of Anchorage was ' + str(anchorage_pop))</b>
The 2010 population of Anchorage was 291826
</code></pre>
<p class="tx">The <i class="calibre5">readCensusExcel.py</i> program was throwaway code: once you have its results saved to <i class="calibre5">census2010.py</i>, you won’t need to run the program again. Whenever you need the county data, you can just run <span class="thesansmonocd_w5regular_">import census2010</span>.</p>
<p class="tx">Calculating this data by hand would have taken hours; this program did it in a few seconds. Using <span class="thesansmonocd_w5regular_">openpyxl</span>, you’ll have no trouble extracting information saved to an Excel spreadsheet and performing calculations on it. You can download the complete program from the book’s online resources.</p>
</section>
<section type="division" aria-labelledby="sec10">
<h4 class="h1" id="calibre_link-1841"><span id="calibre_link-381"></span><span class="sans_futura_std_heavy_oblique_bi_">Ideas for Similar Programs</span></h4>
<p class="tni">Many businesses and offices use Excel to store various types of data, and it’s not uncommon for spreadsheets to become large and unwieldy. Any program that parses an Excel spreadsheet has a similar structure: it loads the spreadsheet file, preps some variables or data structures, and then loops through each of the rows in the spreadsheet. Such a program could do the following:</p>
<ul class="ul">
<li class="bl">Compare data across multiple rows in a spreadsheet.</li>
<li class="bl">Open multiple Excel files and compare data between spreadsheets.</li>
<li class="bl">Check whether a spreadsheet has blank rows or invalid data in any cells and alert the user if it does.</li>
<li class="bl">Read data from a spreadsheet and use it as the input for your Python programs.</li>
</ul>
</section>
</section>
<section type="division" aria-labelledby="sec11">
<h3 class="h" id="calibre_link-1842"><span id="calibre_link-382"></span><span class="sans_futura_std_bold_b_">Writing Excel Documents</span></h3>
<p class="tni">The <span class="thesansmonocd_w5regular_">openpyxl</span> module also provides ways of writing data, meaning that your programs can create and edit spreadsheet files. With Python, creating spreadsheets with thousands of rows of data is simple.</p>
<section type="division" aria-labelledby="sec12">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1072" aria-label="343"></span>
<h4 class="h1" id="calibre_link-1843"><span id="calibre_link-383"></span><span class="sans_futura_std_heavy_oblique_bi_">Creating and Saving Excel Files</span></h4>
<p class="tni">Call the <span class="thesansmonocd_w5regular_">openpyxl.Workbook()</span> function to create a new, blank <span class="thesansmonocd_w5regular_">Workbook</span> object. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()  </b># Create a blank workbook.
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames  </b># The workbook starts with one sheet.
['Sheet']
&gt;&gt;&gt; <b class="calibre10">sheet = wb.active</b>
&gt;&gt;&gt; <b class="calibre10">sheet.title</b>
'Sheet'
&gt;&gt;&gt; <b class="calibre10">sheet.title = 'Spam Bacon Eggs Sheet'  </b># Change the title.
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['Spam Bacon Eggs Sheet']
</code></pre>
<p class="tx">The workbook will start off with a single sheet named <i class="calibre5">Sheet</i>. You can change the name of the sheet by storing a new string in its <span class="thesansmonocd_w5regular_">title</span> attribute.</p>
<p class="tx">Anytime you modify the <span class="thesansmonocd_w5regular_">Workbook</span> object or its sheets and cells, the spreadsheet file will not be saved until you call the <span class="thesansmonocd_w5regular_">save()</span> workbook method. Enter the following into the interactive shell (with <i class="calibre5">example3.xlsx</i> in the current working directory):</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('example3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">sheet.title = 'Spam Spam Spam'</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('example3_copy.xlsx')  </b># Save the workbook.
</code></pre>
<p class="tx">Here, we change the name of our sheet. To save our changes, we pass a filename as a string to the <span class="thesansmonocd_w5regular_">save()</span> method. Passing a different filename than the original, such as <span class="thesansmonocd_w5regular_">'example3_copy.xlsx'</span>, saves the changes to a copy of the spreadsheet.</p>
<p class="tx">Whenever you edit a spreadsheet you’ve loaded from a file, you should always save the new, edited spreadsheet with a different filename than the original. That way, you’ll still have the original spreadsheet file to work with in case a bug in your code caused the new, saved file to contain incorrect or corrupted data. Also, the <span class="thesansmonocd_w5regular_">save()</span> method won’t work if the spreadsheet is currently open in the Excel desktop application. You must first close the spreadsheet and then run your Python program.</p>
</section>
<section type="division" aria-labelledby="sec13">
<h4 class="h1" id="calibre_link-1844"><span id="calibre_link-384"></span><span class="sans_futura_std_heavy_oblique_bi_">Creating and Removing Sheets</span></h4>
<p class="tni">You can create or delete sheets from a workbook with the <span class="thesansmonocd_w5regular_">create_sheet()</span> method and <span class="thesansmonocd_w5regular_">del</span> operator. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['Sheet']
&gt;&gt;&gt; <b class="calibre10">wb.create_sheet()  </b># Add a new sheet.
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1306" aria-label="344"></span>&lt;Worksheet "Sheet1"&gt;
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['Sheet', 'Sheet1']
&gt;&gt;&gt; # Create a new sheet at index 0.
&gt;&gt;&gt; <b class="calibre10">wb.create_sheet(index=0, title='First Sheet')</b>
&lt;Worksheet "First Sheet"&gt;
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['First Sheet', 'Sheet', 'Sheet1']
&gt;&gt;&gt; <b class="calibre10">wb.create_sheet(index=2, title='Middle Sheet')</b>
&lt;Worksheet "Middle Sheet"&gt;
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['First Sheet', 'Sheet', 'Middle Sheet', 'Sheet1']
</code></pre>
<p class="tx">The <span class="thesansmonocd_w5regular_">create_sheet()</span> method returns a new <span class="thesansmonocd_w5regular_">Worksheet</span> object named <span class="thesansmonocd_w5regular_">Sheet</span><span class="sans_thesansmonocd_w5regular_italic_">X</span>, which by default is the last sheet in the workbook. Optionally, you can specify the index and name of the new sheet with the <span class="thesansmonocd_w5regular_">index</span> and <span class="thesansmonocd_w5regular_">title</span> keyword arguments.</p>
<p class="tx">Continue the previous example by entering the following:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['First Sheet', 'Sheet', 'Middle Sheet', 'Sheet1']
&gt;&gt;&gt; <b class="calibre10">del wb['Middle Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">del wb['Sheet1']</b>
&gt;&gt;&gt; <b class="calibre10">wb.sheetnames</b>
['First Sheet', 'Sheet']
</code></pre>
<p class="tx">You can use the <span class="thesansmonocd_w5regular_">del</span> operator to delete a sheet from a workbook, just like you can use it to delete a key-value pair from a dictionary.</p>
<p class="tx">Remember to call the <span class="thesansmonocd_w5regular_">save()</span> method to save the changes after adding sheets to or removing sheets from the workbook.</p>
</section>
<section type="division" aria-labelledby="sec14">
<h4 class="h1" id="calibre_link-1845"><span id="calibre_link-385"></span><span class="sans_futura_std_heavy_oblique_bi_">Writing Values to Cells</span></h4>
<p class="tni">Writing values to cells is much like writing values to keys in a dictionary. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 'Hello, world!'  </b># Edit the cell's value.
&gt;&gt;&gt; <b class="calibre10">sheet['A1'].value</b>
'Hello, world!'
</code></pre>
<p class="tx">If you have the cell’s coordinate as a string, you can use it just like a dictionary key on the <span class="thesansmonocd_w5regular_">Worksheet</span> object to specify which cell to write to.</p>
<p class="ph"><span id="calibre_link-386"></span><span class="sans_futura_std_heavy_b_">Project 10: Update a Spreadsheet</span></p>
<p class="tni">In this project, you’ll write a program to update cells in a spreadsheet of produce sales. Your program will look through the spreadsheet, find specific <span role="doc-pagebreak" type="pagebreak" id="calibre_link-1140" aria-label="345"></span>kinds of produce, and update their prices. Download this <i class="calibre5">produceSales3.xlsx</i> spreadsheet from the book’s online resources. Figure 14-3 shows what the spreadsheet looks like.</p>
<figure class="img"><img class="img1" id="calibre_link-759" src="../assets/automatetheboringstuff.com/3e/images/000021.jpg" alt="An Excel spreadsheet with the columns “PRODUCE”, “COST PER POUND”, “POUNDS SOLD”, and “TOTAL”. The rows contain details about various produce items." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-3: A spreadsheet of produce sales</span></p></figcaption>
</figure>
<p class="tx">Each row represents an individual sale. The columns are the type of produce sold (A), the cost per pound of that produce (B), the number of pounds sold (C), and the total revenue from the sale (D). The TOTAL column is set to an Excel formula like <i class="calibre5">=ROUND(B2*C2, 2)</i>, which multiplies the row’s cost per pound by the number of pounds sold and rounds the result to the nearest cent. With this formula, the cells in the TOTAL column will automatically update themselves if there is a change in the COST PER POUND and POUNDS SOLD columns.</p>
<p class="tx">Now imagine that the prices of garlic, celery, and lemons were entered incorrectly, leaving you with the boring task of going through thousands of rows in this spreadsheet to update the cost per pound for any celery, garlic, and lemon rows. You can’t do a simple find-and-replace for the price, because there might be other items with the same price that you don’t want to mistakenly “correct.” For thousands of rows, this would take hours to do by hand. But you can write a program that can accomplish this in seconds.</p>
<p class="tx">Your program should do the following:</p>
<ul class="ul">
<li class="bl">Loop over all the rows.</li>
<li class="bl">If the row is for celery, garlic, or lemons, change the price.</li>
</ul>
<p class="tx">This means your code will need to do the following:</p>
<ul class="ul">
<li class="bl">Open the spreadsheet file.</li>
<li class="bl">For each row, check whether the value in column A is <span class="thesansmonocd_w5regular_">Celery</span>, <span class="thesansmonocd_w5regular_">Garlic</span>, or <span class="thesansmonocd_w5regular_">Lemon</span>.</li>
<li class="bl">If it is, update the price in column B.</li>
<li class="bl">Save the spreadsheet to a new file (so that you don’t lose the original spreadsheet, just in case).</li>
</ul>
</section>
<section type="division" aria-labelledby="sec15">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1308" aria-label="346"></span>
<h4 class="h1" id="calibre_link-1846"><span id="calibre_link-387"></span><span class="sans_futura_std_heavy_oblique_bi_">Step 1: Set Up a Data Structure with the Updated Information</span></h4>
<p class="tni">The prices that you need to update are as follows:</p>
<ul class="ul">
<li class="bl">Celery: 1.19</li>
<li class="bl">Garlic: 3.07</li>
<li class="bl">Lemon: 1.27</li>
</ul>
<p class="tx">You could write code to set these new prices, like this:</p>
<pre class="pre"><code class="calibre9">if produce_name == 'Celery':
    cell_obj = 1.19
if produce_name == 'Garlic':
    cell_obj = 3.07
if produce_name == 'Lemon':
    cell_obj = 1.27
</code></pre>
<p class="tx">But hardcoding the produce and updated price data like this is a bit inelegant. If you needed to update the spreadsheet again with different prices or different produce, you would have to change a lot of the code. Every time you change code, you risk introducing bugs.</p>
<p class="tx">A more flexible solution is to store the corrected price information in a dictionary and write your code to use this data structure. In a new file editor tab, enter the following code:</p>
<pre class="pre"><code class="calibre9"># updateProduce.py - Corrects costs in produce sales spreadsheet

import openpyxl

wb = openpyxl.load_workbook('produceSales3.xlsx')
sheet = wb['Sheet']

# The produce types and their updated prices
PRICE_UPDATES = {'Garlic': 3.07,
                 'Celery': 1.19,
                 'Lemon': 1.27}

# TODO: Loop through the rows and update the prices.
</code></pre>
<p class="tx">Save this as <i class="calibre5">updateProduce.py</i>. If you need to update the spreadsheet again, you’ll need to update only the <span class="thesansmonocd_w5regular_">PRICE_UPDATES</span> dictionary, not any other code.</p>
</section>
<section type="division" aria-labelledby="sec16">
<h4 class="h1" id="calibre_link-1847"><span id="calibre_link-388"></span><span class="sans_futura_std_heavy_oblique_bi_">Step 2: Check All Rows and Update Incorrect Prices</span></h4>
<p class="tni">The next part of the program will loop through all the rows in the spreadsheet. Add the following code to the bottom of <i class="calibre5">updateProduce.py</i>:</p>
<pre class="pre"><code class="calibre9"># updateProduce.py - Corrects costs in produce sales spreadsheet

<var class="calibre20">--snip--</var>

<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1307" aria-label="347"></span><b class="calibre10"># Loop through the rows and update the prices.</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span><b class="calibre10"> for row_num in range(2, sheet.max_row + 1):  </b># Skip the first row.
<b class="calibre10">  </b><span class="code_codeannotation" aria-label="annotation2">❷</span><b class="calibre10"> produce_name = sheet.cell(row=row_num, column=1).value</b>
  <span class="code_codeannotation" aria-label="annotation3">❸</span><b class="calibre10"> if produce_name in PRICE_UPDATES:</b>
<b class="calibre10">        sheet.cell(row=row_num, column=2).value = PRICE_UPDATES[produce_name]</b>

<span class="codeannotated_codeannotation" aria-label="annotation4">❹</span> <b class="calibre10">wb.save('updatedProduceSales3.xlsx')</b>
</code></pre>
<p class="tx">We loop through the rows starting at row 2, as row 1 is just the header <span class="codeannotation" aria-label="annotation1">❶</span>. The cell in column 1 (that is, column A) will be stored in the variable <span class="thesansmonocd_w5regular_">produce _name</span> <span class="codeannotation" aria-label="annotation2">❷</span>. If <span class="thesansmonocd_w5regular_">produce_name</span> exists as a key in the <span class="thesansmonocd_w5regular_">PRICE_UPDATES</span> dictionary <span class="codeannotation" aria-label="annotation3">❸</span>, you know this row needs its price corrected. The correct price will be in <span class="thesansmonocd_w5regular_">PRICE _UPDATES[produce_name]</span>.</p>
<p class="tx">Notice how clean using <span class="thesansmonocd_w5regular_">PRICE_UPDATES</span> makes the code. It uses only one <span class="thesansmonocd_w5regular_">if</span> statement, rather than a separate line like <span class="thesansmonocd_w5regular_">if produce_name</span> <span class="thesansmonocd_w5regular_">==</span> <span class="thesansmonocd_w5regular_">'Garlic':</span> for every type of produce to update. And since the code uses the <span class="thesansmonocd_w5regular_">PRICE_UPDATES</span> dictionary instead of hardcoding the produce names and updated costs into the <span class="thesansmonocd_w5regular_">for</span> loop, you can modify only the <span class="thesansmonocd_w5regular_">PRICE_UPDATES</span> dictionary, and not the rest of the code, if the produce sales spreadsheet needs additional changes.</p>
<p class="tx">After going through the entire spreadsheet and making changes, the code saves the <span class="thesansmonocd_w5regular_">Workbook</span> object to <i class="calibre5">updatedProduceSales3.xlsx</i> <span class="codeannotation" aria-label="annotation4">❹</span>. It doesn’t overwrite the old spreadsheet, in case there’s a bug in the program and the updated spreadsheet is wrong. After checking that the updated spreadsheet looks right, you can delete the old spreadsheet.</p>
</section>
<section type="division" aria-labelledby="sec17">
<h4 class="h1"><span id="calibre_link-1848"></span><span id="calibre_link-389"></span><span class="sans_futura_std_heavy_oblique_bi_">Ideas for Similar Programs</span></h4>
<p class="tni">Since many office workers use Excel spreadsheets all the time, a program that can automatically edit and write Excel files could be really useful. Such a program could do the following:</p>
<ul class="ul">
<li class="bl">Read data from one spreadsheet and write it to parts of other spreadsheets.</li>
<li class="bl">Read data from websites, text files, or the clipboard and write it to a spreadsheet.</li>
<li class="bl">Automatically “clean up” data in spreadsheets. For example, it could use regular expressions to read multiple formats of phone numbers and edit them to a single, standard format.</li>
</ul>
</section>
</section>
<section type="division" aria-labelledby="sec18">
<h3 class="h" id="calibre_link-1849"><span id="calibre_link-390"></span><span class="sans_futura_std_bold_b_">Setting the Font Style of Cells</span></h3>
<p class="tni">Styling certain cells, rows, or columns can help you emphasize important areas in your spreadsheet. In the produce spreadsheet, for example, your program could apply bold text to the potato, garlic, and parsnip rows. Or perhaps you want to italicize every row with a cost per pound greater than $5. Styling parts of a large spreadsheet by hand would be tedious, but your programs can do it instantly.</p>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-993" aria-label="348"></span>To customize font styles in cells, import the <span class="thesansmonocd_w5regular_">Font()</span> function from the <span class="thesansmonocd_w5regular_">openpyxl.styles</span> module:</p>
<pre class="pre"><code class="calibre9">from openpyxl.styles import Font</code></pre>
<p class="tx">Importing the function in this way allows you to write <span class="thesansmonocd_w5regular_">Font()</span> instead of <span class="thesansmonocd_w5regular_">openpyxl.styles.Font()</span>. (See <span>“Importing Modules” on Chapter 3</span> for more information.)</p>
<p class="tx">The following example creates a new workbook and sets cell A1 to a 24-point italic font:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">from openpyxl.styles import Font</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
<span class="codeannotated_codeannotation" aria-label="annotation1">❶</span> &gt;&gt;&gt; <b class="calibre10">italic_24_font = Font(size=24, italic=True) </b>
<span class="codeannotated_codeannotation" aria-label="annotation2">❷</span> &gt;&gt;&gt; <b class="calibre10">sheet['A1'].font = italic_24_font </b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 'Hello, world!'</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('styles3.xlsx')</b>
</code></pre>
<p class="tx">In this example, <span class="thesansmonocd_w5regular_">Font(size=24, italic=True)</span> returns a <span class="thesansmonocd_w5regular_">Font</span> object, which we store in <span class="thesansmonocd_w5regular_">italic_24_font</span> <span class="codeannotation" aria-label="annotation1">❶</span>. The keyword arguments to <span class="thesansmonocd_w5regular_">Font()</span> configure the object’s styling information, and assigning <span class="thesansmonocd_w5regular_">sheet['A1'].font</span> the <span class="thesansmonocd_w5regular_">italic _24_font</span> object <span class="codeannotation" aria-label="annotation2">❷</span> applies all of that font-styling information to cell A1.</p>
<p class="tx">To set <span class="thesansmonocd_w5regular_">font</span> attributes, pass keyword arguments to <span class="thesansmonocd_w5regular_">Font()</span>. Table 14-2 shows the possible keyword arguments for the <span class="thesansmonocd_w5regular_">Font()</span> function.</p>
<table class="basic-table">
<caption class="calibre12"><p class="tt" id="calibre_link-761"><span class="sans_futura_std_bold_b_"><span class="sans_futura_std_bold_b_">Table 14-2:</span></span> <span class="sans_futura_std_book_">Keyword Arguments for</span> <span class="thesansmonocd_w5regular_">Font</span> <span class="sans_futura_std_book_">Objects</span></p></caption>

<thead class="calibre13">
<tr class="calibre14">
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">Keyword argument</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">Data type</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_futura_std_bold_b_">Description</span></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="calibre16">
<td class="tbf"><p class="tch1"><span class="thesansmonocd_w5regular_">name</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">String</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">The font name, such as</span> <span class="thesansmonocd_w5regular_">'Calibri'</span> <span class="sans_futura_std_book_">or</span> <span class="thesansmonocd_w5regular_">'Times New Roman'</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">size</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Integer</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">The point size</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">bold</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Boolean</span></p></td>
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">True</span><span class="sans_futura_std_book_">, for bold font</span></p></td>
</tr>
<tr class="calibre14">
<td class="tbl"><p class="tch1"><span class="thesansmonocd_w5regular_">italic</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">Boolean</span></p></td>
<td class="tbl"><p class="tch1"><span class="thesansmonocd_w5regular_">True</span><span class="sans_futura_std_book_">, for italic font</span></p></td>
</tr>
</tbody>
</table>
<p class="tx">You can call <span class="thesansmonocd_w5regular_">Font()</span> to create a <span class="thesansmonocd_w5regular_">Font</span> object and store that <span class="thesansmonocd_w5regular_">Font</span> object in a variable. You then assign that variable to a <span class="thesansmonocd_w5regular_">Cell</span> object’s <span class="thesansmonocd_w5regular_">font</span> attribute. For example, this code creates various font styles:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">from openpyxl.styles import Font</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">bold_font = Font(name='Times New Roman', bold=True)</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'].font = bold_font</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 'Bold Times New Roman'</b>

<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1141" aria-label="349"></span>&gt;&gt;&gt; <b class="calibre10">italic_font = Font(size=24, italic=True)</b>
&gt;&gt;&gt; <b class="calibre10">sheet['B3'].font = italic_font</b>
&gt;&gt;&gt; <b class="calibre10">sheet['B3'] = '24 pt Italic'</b>

&gt;&gt;&gt; <b class="calibre10">wb.save('styles3.xlsx')</b>
</code></pre>
<p class="tx">Here, we store a <span class="thesansmonocd_w5regular_">Font</span> object in <span class="thesansmonocd_w5regular_">bold_font</span> and then set the A1 <span class="thesansmonocd_w5regular_">Cell</span> object’s <span class="thesansmonocd_w5regular_">font</span> attribute to <span class="thesansmonocd_w5regular_">bold_font</span>. We repeat the process with another <span class="thesansmonocd_w5regular_">Font</span> object to set the font of a second cell. After you run this code, the styles of the A1 and B3 cells in the spreadsheet will have custom font styles, as shown in Figure 14-4.</p>
<figure class="img"><img class="img2" id="calibre_link-762" src="../assets/automatetheboringstuff.com/3e/images/000022.jpg" alt="An Excel spreadsheet in which cell A1 contains the text “Bold Times New Roman” in a bolded Times New Roman font and cell B3 contains the text” 24 pt Italic” in a large, italicized font." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-4: A spreadsheet with custom font styles</span></p></figcaption>
</figure>
<p class="tx">For cell A1, we set the font name to <span class="thesansmonocd_w5regular_">'Times New Roman'</span> and set <span class="thesansmonocd_w5regular_">bold</span> to <span class="thesansmonocd_w5regular_">true</span>, so the text appears in bold Times New Roman. We didn’t specify a point size, so the text uses the <span class="thesansmonocd_w5regular_">openpyxl</span> default, 11. In cell B3, the text is italic, with a point size of 24. We didn’t specify a font name, so the text uses the <span class="thesansmonocd_w5regular_">openpyxl</span> default, Calibri.</p>
</section>
<section type="division" aria-labelledby="sec19">
<h3 class="h" id="calibre_link-1850"><span id="calibre_link-391"></span><span class="sans_futura_std_bold_b_">Formulas</span></h3>
<p class="tni">Excel formulas, which begin with an equal sign, can configure cells to contain values calculated from other cells. In this section, you’ll use the <span class="thesansmonocd_w5regular_">openpyxl</span> module to programmatically add formulas to cells, just as you would add any normal value. Here is an example:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">sheet['B9'] = '=SUM(B1:B8)'</b></code></pre>
<p class="tx">This code will store the formula <i class="calibre5">=SUM(B1:B8)</i> in B9, setting the cell’s value to the sum of values in cells B1 to B8. You can see this in action in Figure 14-5.</p>
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1091" aria-label="350"></span>
<figure class="img"><img class="img2" id="calibre_link-763" src="../assets/automatetheboringstuff.com/3e/images/000023.jpg" alt="An Excel spreadsheet containing a list of numbers in column B. Cell A9 contains the text “TOTAL:”, and cell B9 contains the sum of the other values in column B. The cell is highlighted, and the formula =SUM(B1:B8) is shown in the interface’s top-right corner." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-5: Cell B9 contains the formula to add the values in cells B1 to B8.</span></p></figcaption>
</figure>
<p class="tx">You can set an Excel formula just like any other text value in a cell. For instance, enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 200</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A2'] = 300</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A3'] = '=SUM(A1:A2)'</b> # Set the formula.
&gt;&gt;&gt; <b class="calibre10">wb.save('writeFormula3.xlsx')</b>
</code></pre>
<p class="tx">The cells in A1 and A2 are set to 200 and 300, respectively. The value in cell A3 is set to a formula that sums the values in A1 and A2. When the spreadsheet is opened in Excel, A3 will display its value as 500.</p>
<p class="tx">The <span class="thesansmonocd_w5regular_">openpyxl</span> module doesn’t have the ability to calculate Excel formulas and populate cells with the results. However, if you open this <i class="calibre5">writeFormula3 .xlsx</i> file in Excel, Excel itself will populate the cells with the formula results. You can save the file in Excel, and then open it while passing the <span class="thesansmonocd_w5regular_">data_only=True</span> keyword argument to <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span>, and the cell values should show the calculation results instead of the formula string:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; # Be sure to open writeFormula3.xlsx in Excel and save it first.
&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('writeFormula3.xlsx')</b>  # Open without data_only.
&gt;&gt;&gt; <b class="calibre10">wb.active['A3'].value</b>  # Get the formula string.
'=SUM(A1:A2)'
&gt;&gt;&gt;<b class="calibre10"> wb = openpyxl.load_workbook('writeFormula3.xlsx', data_only=True)</b>  # Open with data_only.
&gt;&gt;&gt; <b class="calibre10">wb.active['A3'].value</b>  # Get the formula result.
500
</code></pre>
<p class="tx">Again, you’ll only see the <span class="thesansmonocd_w5regular_">500</span> result in the spreadsheet file if you opened and saved it in Excel so that Excel could run the formula calculation and store the result in the spreadsheet file. This is the value <span class="thesansmonocd_w5regular_">openpyxl</span> reads when you pass <span class="thesansmonocd_w5regular_">data_only=True</span> to <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span>.</p>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1034" aria-label="351"></span>Excel formulas offer a level of programmability for spreadsheets, but they can quickly become unmanageable for complicated tasks. For example, even if you’re deeply familiar with Excel formulas, it’s a headache to try to decipher what <i class="calibre5">=IFERROR(TRIM(IF(LEN(VLOOKUP(F7, Sheet2!$A$1:$B$10000, 2, FALSE))&gt;0,SUBSTITUTE(VLOOKUP(F7, Sheet2!$A$1:$B$10000, 2, FALSE), " ", ""),"")), "")</i> actually does. Python code is much more readable.</p>
</section>
<section type="division" aria-labelledby="sec20">
<h3 class="h" id="calibre_link-1851"><span id="calibre_link-392"></span><span class="sans_futura_std_bold_b_">Adjusting Rows and Columns</span></h3>
<p class="tni">In Excel, adjusting the sizes of rows and columns is as easy as clicking and dragging the edges of a row or column header. But if you need to set the size of a row or column based on its cells’ contents, or if you want to set sizes in a large number of spreadsheet files, it’s much quicker to write a Python program to do it.</p>
<p class="tx">You can also hide rows and columns from view, or “freeze” them in place so that they’re always visible on the screen, appearing on every page when you print the spreadsheet (which is handy for headers).</p>
<section type="division" aria-labelledby="sec21">
<h4 class="h1" id="calibre_link-1852"><span id="calibre_link-393"></span><span class="sans_futura_std_heavy_oblique_bi_">Setting Row Height and Column Width</span></h4>
<p class="tni">A <span class="thesansmonocd_w5regular_">Worksheet</span> object has <span class="thesansmonocd_w5regular_">row_dimensions</span> and <span class="thesansmonocd_w5regular_">column_dimensions</span> attributes that control row heights and column widths. For example, enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 'Tall row'</b>
&gt;&gt;&gt; <b class="calibre10">sheet['B2'] = 'Wide column'</b>
&gt;&gt;&gt; <b class="calibre10">sheet.row_dimensions[1].height = 70</b>
&gt;&gt;&gt; <b class="calibre10">sheet.column_dimensions['B'].width = 20</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('dimensions3.xlsx')</b>
</code></pre>
<p class="tx">A sheet’s <span class="thesansmonocd_w5regular_">row_dimensions</span> and <span class="thesansmonocd_w5regular_">column_dimensions</span> are dictionary-like values; <span class="thesansmonocd_w5regular_">row_dimensions</span> contains <span class="thesansmonocd_w5regular_">RowDimension</span> objects, and <span class="thesansmonocd_w5regular_">column_dimensions</span> contains <span class="thesansmonocd_w5regular_">ColumnDimension</span> objects. In <span class="thesansmonocd_w5regular_">row_dimensions</span>, you can access one of the objects using the number of the row (in this case, 1 or 2). In <span class="thesansmonocd_w5regular_">column_dimensions</span>, you can access one of the objects using the letter of the column (in this case, A or B).</p>
<p class="tx">The <i class="calibre5">dimensions3.xlsx</i> spreadsheet looks like Figure 14-6.</p>
<figure class="img"><img class="img2" id="calibre_link-764" src="../assets/automatetheboringstuff.com/3e/images/000024.jpg" alt="An Excel spreadsheet in which row 1 is taller than usual and column B is wider than usual. Cell A1 contains the text “Tall row” and cell B1” contains the text “Wide column”." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-6: Row 1 and column B set to larger heights and widths</span></p></figcaption>
</figure>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1036" aria-label="352"></span>The default width and height of cells varies between versions of Excel and <span class="thesansmonocd_w5regular_">openpyxl</span>.</p>
</section>
<section type="division" aria-labelledby="sec22">
<h4 class="h1" id="calibre_link-1853"><span id="calibre_link-394"></span><span class="sans_futura_std_heavy_oblique_bi_">Merging and Unmerging Cells</span></h4>
<p class="tni">You can merge a rectangular group of cells into a single cell with the <span class="thesansmonocd_w5regular_">merge _cells()</span> sheet method. Enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">sheet.merge_cells('A1:D3')  </b># Merge all these cells.
&gt;&gt;&gt; <b class="calibre10">sheet['A1'] = 'Twelve cells merged together.'</b>
&gt;&gt;&gt; <b class="calibre10">sheet.merge_cells('C5:D5')  </b># Merge these two cells.
&gt;&gt;&gt; <b class="calibre10">sheet['C5'] = 'Two merged cells.'</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('merged3.xlsx')</b>
</code></pre>
<p class="tx">The argument to <span class="thesansmonocd_w5regular_">merge_cells()</span> is a single string of the top-left and bottom-right cells of the rectangular area to be merged: <span class="thesansmonocd_w5regular_">'A1:D3'</span> merges 12 cells into a single cell. To set the value of these merged cells, simply set the value of the top-left cell of the merged group.</p>
<p class="tx">When you run this code, <i class="calibre5">merged.xlsx</i> will look like Figure 14-7.</p>
<figure class="img"><img class="img2" id="calibre_link-765" src="../assets/automatetheboringstuff.com/3e/images/000025.jpg" alt="An excel spreadsheet in which cells A1 through D3 are all merged into one, with no delineating grid lines. This cell contains the text “Twelve cells merged together.” The cells C5 and B5 are also merged and contain the text “Two merged cells.”" />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-7: Merged cells in a spreadsheet</span></p></figcaption>
</figure>
<p class="tx">To unmerge cells, call the <span class="thesansmonocd_w5regular_">unmerge_cells()</span> sheet method:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('merged3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb['Sheet']</b>
&gt;&gt;&gt; <b class="calibre10">sheet.unmerge_cells('A1:D3')  </b># Split these cells up.
&gt;&gt;&gt; <b class="calibre10">sheet.unmerge_cells('C5:D5')</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('unmerged3.xlsx')</b>
</code></pre>
<p class="tx">If you save your changes and then take a look at the spreadsheet, you’ll see that the merged cells have gone back to being individual cells.</p>
</section>
<section type="division" aria-labelledby="sec23">
<h4 class="h1" id="calibre_link-1854"><span id="calibre_link-395"></span><span class="sans_futura_std_heavy_oblique_bi_">Freezing Panes</span></h4>
<p class="tni">For spreadsheets that are too large to be displayed all at once, it’s helpful to “freeze” a few of the top rows or leftmost columns onscreen. Frozen column or row headers, for example, are always visible to the user even as they scroll through the spreadsheet. These are known as <i class="calibre5">freeze panes</i>.</p>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1168" aria-label="353"></span>In <span class="thesansmonocd_w5regular_">openpyxl</span>, each <span class="thesansmonocd_w5regular_">Worksheet</span> object has a <span class="thesansmonocd_w5regular_">freeze_panes</span> attribute that you can set to a <span class="thesansmonocd_w5regular_">Cell</span> object or a string of a cell’s coordinates. Note that this attribute will freeze all rows above this cell and all columns to the left of it, but not the row and column of the cell itself. To unfreeze all panes, set <span class="thesansmonocd_w5regular_">freeze _panes</span> to <span class="thesansmonocd_w5regular_">None</span> or <span class="thesansmonocd_w5regular_">'A1'</span>. Table 14-3 shows which rows and columns get frozen for some example settings of <span class="thesansmonocd_w5regular_">freeze_panes</span>.</p>
<table class="basic-table">
<caption class="calibre12"><p class="tt" id="calibre_link-766"><span class="sans_futura_std_bold_b_"><span class="sans_futura_std_bold_b_">Table 14-3:</span></span> <span class="sans_futura_std_book_">Frozen Pane Examples</span></p></caption>

<thead class="calibre13">
<tr class="calibre14">
<th class="tch" scope="col"><p class="tch1"><span class="sans_thesansmonocd_w7bold_b_">freeze_panes setting</span></p></th>
<th class="tch" scope="col"><p class="tch1"><span class="sans_thesansmonocd_w7bold_b_">Rows and columns frozen</span></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="calibre16">
<td class="tbf"><p class="tch1"><span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">'A2'</span></p></td>
<td class="tbf"><p class="tch1"><span class="sans_futura_std_book_">Row 1 (no columns frozen)</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">'B1'</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Column A (no rows frozen)</span></p></td>
</tr>
<tr class="calibre16">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">'C1'</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Columns A and B (no rows frozen)</span></p></td>
</tr>
<tr class="calibre14">
<td class="tb"><p class="tch1"><span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">'C2'</span></p></td>
<td class="tb"><p class="tch1"><span class="sans_futura_std_book_">Row 1 and columns A and B</span></p></td>
</tr>
<tr class="calibre16">
<td class="tbl"><p class="tch1"><span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">'A1'</span> <span class="sans_futura_std_book_">or</span> <span class="thesansmonocd_w5regular_">sheet.freeze_panes</span> <span class="thesansmonocd_w5regular_">=</span> <span class="thesansmonocd_w5regular_">None</span></p></td>
<td class="tbl"><p class="tch1"><span class="sans_futura_std_book_">No frozen rows or columns</span></p></td>
</tr>
</tbody>
</table>
<p class="tx">Download another copy of the <i class="calibre5">produceSales3.xlsx</i> spreadsheet, then enter the following into the interactive shell:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.load_workbook('produceSales3.xlsx')</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb.active</b>
&gt;&gt;&gt; <b class="calibre10">sheet.freeze_panes = 'A2'  </b># Freeze the rows above A2.
&gt;&gt;&gt; <b class="calibre10">wb.save('freezeExample3.xlsx')</b>
</code></pre>
<p class="tx">You can see the result in Figure 14-8.</p>
<figure class="img"><img class="img1" id="calibre_link-767" src="../assets/automatetheboringstuff.com/3e/images/000026.jpg" alt="An Excel spreadsheet in which Row 1 is visible as the user scrolls to the right." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-8: Freezing row 1</span></p></figcaption>
</figure>
<p class="tx">Because you set the <span class="thesansmonocd_w5regular_">freeze_panes</span> attribute to <span class="thesansmonocd_w5regular_">'A2'</span>, row 1 will remain visible, no matter where the user scrolls in the spreadsheet.</p>
</section>
</section>
<section type="division" aria-labelledby="sec24">
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-952" aria-label="354"></span>
<h3 class="h" id="calibre_link-1855"><span id="calibre_link-396"></span><span class="sans_futura_std_bold_b_">Charts</span></h3>
<p class="tni">The <span class="thesansmonocd_w5regular_">openpyxl</span> module supports creating bar, line, scatter, and pie charts using the data in a sheet’s cells. To make a chart, you need to do the following:</p>
<p class="listnumberf">  1.  Create a <span class="thesansmonocd_w5regular_">Reference</span> object from a rectangular selection of cells.</p>
<p class="listnumber">  2.  Create a <span class="thesansmonocd_w5regular_">Series</span> object by passing in the <span class="thesansmonocd_w5regular_">Reference</span> object.</p>
<p class="listnumber">  3.  Create a <span class="thesansmonocd_w5regular_">Chart</span> object.</p>
<p class="listnumber">  4.  Append the <span class="thesansmonocd_w5regular_">Series</span> object to the <span class="thesansmonocd_w5regular_">Chart</span> object.</p>
<p class="listnumberl">  5.  Add the <span class="thesansmonocd_w5regular_">Chart</span> object to the <span class="thesansmonocd_w5regular_">Worksheet</span> object, optionally specifying which cell should be the top-left corner of the chart.</p>
<p class="tx">The <span class="thesansmonocd_w5regular_">Reference</span> object requires some explaining. To create <span class="thesansmonocd_w5regular_">Reference</span> objects, you must call the <span class="thesansmonocd_w5regular_">openpyxl.chart.Reference()</span> function and pass five arguments:</p>
<ul class="ul">
<li class="bl">The <span class="thesansmonocd_w5regular_">Worksheet</span> object containing your chart data.</li>
<li class="bl">The column and row integer of the top-left cell of the rectangular selection of cells containing your chart data: the first integer in the tuple is the row, and the second is the column. Note that <span class="thesansmonocd_w5regular_">1</span> is the first row, not <span class="thesansmonocd_w5regular_">0</span>.</li>
<li class="bl">The column and row integer of the bottom-right cell of the rectangular selection of cells containing your chart data: the first integer in the tuple is the row, and the second is the column.</li>
</ul>
<p class="tx">Enter this interactive shell example to create a bar chart and add it to the spreadsheet:</p>
<pre class="pre"><code class="calibre9">&gt;&gt;&gt; <b class="calibre10">import openpyxl</b>
&gt;&gt;&gt; <b class="calibre10">wb = openpyxl.Workbook()</b>
&gt;&gt;&gt; <b class="calibre10">sheet = wb.active</b>
&gt;&gt;&gt; <b class="calibre10">for i in range(1, 11):  </b># Create some data in column A.
...<b class="calibre10">     sheet['A' + str(i)] = i * i</b>
...
&gt;&gt;&gt; <b class="calibre10">ref_obj = openpyxl.chart.Reference(sheet, 1, 1,</b> <b class="calibre10">1, 10)</b>

&gt;&gt;&gt; <b class="calibre10">series_obj = openpyxl.chart.Series(ref_obj, title='First series')</b>

&gt;&gt;&gt; <b class="calibre10">chart_obj = openpyxl.chart.BarChart()</b>
&gt;&gt;&gt; <b class="calibre10">chart_obj.title = 'My Chart'</b>
&gt;&gt;&gt; <b class="calibre10">chart_obj.append(series_obj)</b>

&gt;&gt;&gt; <b class="calibre10">sheet.add_chart(chart_obj, 'C5')</b>
&gt;&gt;&gt; <b class="calibre10">wb.save('sampleChart3.xlsx')</b>
</code></pre>
<p class="tx">This code produces a spreadsheet that looks like Figure 14-9.</p>
<span role="doc-pagebreak" type="pagebreak" id="calibre_link-1218" aria-label="355"></span>
<figure class="img"><img class="img1" id="calibre_link-768" src="../assets/automatetheboringstuff.com/3e/images/000027.jpg" alt="An Excel spreadsheet with a numbers populated in column A. In the center of the spreadsheet is a bar chart whose bars correspond to the column A values and are labeled using the row numbers." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-9: A spreadsheet with a chart added</span></p></figcaption>
</figure>
<p class="tx">We’ve created a bar chart by calling <span class="thesansmonocd_w5regular_">openpyxl.chart.BarChart()</span>. You can also create line charts, scatter charts, and pie charts by calling <span class="thesansmonocd_w5regular_">openpyxl.chart .LineChart()</span>, <span class="thesansmonocd_w5regular_">openpyxl.chart.ScatterChart()</span>, and <span class="thesansmonocd_w5regular_">openpyxl.chart.PieChart()</span>.</p>
</section>
<section type="conclusion" role="doc-conclusion" aria-labelledby="sec25">
<h3 class="h" id="calibre_link-1856"><span id="calibre_link-397"></span><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">Often, the hard part of processing information isn’t the processing itself but simply getting the data in the right format for your program. But once you’ve loaded your Excel spreadsheet into Python, you can extract and manipulate its data much faster than you could by hand.</p>
<p class="tx">You can also generate spreadsheets as output from your programs. So, if colleagues need a text file or PDF of thousands of sales contacts transferred to a spreadsheet file, you won’t have to tediously copy and paste it all into Excel. Equipped with the <span class="thesansmonocd_w5regular_">openpyxl</span> module and some programming knowledge, you’ll find processing even the biggest spreadsheets a piece of cake.</p>
<p class="tx">In the next chapter, we’ll take a look at using Python to interact with another spreadsheet program: the popular online Google Sheets application.</p>
</section>
<section type="division" aria-labelledby="sec26">
<h3 class="h" id="calibre_link-1857"><span id="calibre_link-398"></span><span class="sans_futura_std_bold_b_">Practice Questions</span></h3>
<p class="tni">For the following questions, imagine you have a <span class="thesansmonocd_w5regular_">Workbook</span> object in the variable <span class="thesansmonocd_w5regular_">wb</span>, a <span class="thesansmonocd_w5regular_">Worksheet</span> object in <span class="thesansmonocd_w5regular_">sheet</span>, and a <span class="thesansmonocd_w5regular_">Sheet</span> object in <span class="thesansmonocd_w5regular_">sheet</span>.</p>
<p class="listnumber">  1.  What does the <span class="thesansmonocd_w5regular_">openpyxl.load_workbook()</span> function return?</p>
<p class="listnumber">  2.  What does the <span class="thesansmonocd_w5regular_">wb.sheetnames</span> workbook attribute contain?</p>
<p class="listnumber">  3.  How would you retrieve the <span class="thesansmonocd_w5regular_">Worksheet</span> object for a sheet named <span class="thesansmonocd_w5regular_">'Sheet1'</span>?</p>
<p class="listnumber"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-1242" aria-label="356"></span>  4.  How would you retrieve the <span class="thesansmonocd_w5regular_">Worksheet</span> object for the workbook’s active sheet?</p>
<p class="listnumber">  5.  How would you retrieve the value in cell C5?</p>
<p class="listnumber">  6.  How would you set the value in cell C5 to <span class="thesansmonocd_w5regular_">"Hello"</span>?</p>
<p class="listnumber">  7.  How would you retrieve the cell’s row and column as integers?</p>
<p class="listnumber">  8.  What do the <span class="thesansmonocd_w5regular_">sheet.max_column</span> and <span class="thesansmonocd_w5regular_">sheet.max_row</span> sheet attributes hold, and what is the data type of these attributes?</p>
<p class="listnumber">  9.  If you needed to get the integer index for column <span class="thesansmonocd_w5regular_">'M'</span>, what function would you need to call?</p>
<p class="listnumber">10.  If you needed to get the string name for row <span class="thesansmonocd_w5regular_">14</span>, what function would you need to call?</p>
<p class="listnumber">11.  How can you retrieve a tuple of all the <span class="thesansmonocd_w5regular_">Cell</span> objects from A1 to F1?</p>
<p class="listnumber">12.  How would you save the workbook to the filename <i class="calibre5">example3.xlsx</i>?</p>
<p class="listnumber">13.  How do you set a formula in a cell?</p>
<p class="listnumber">14.  If you want to retrieve the result of a cell’s formula instead of the cell’s formula itself, what must you do first?</p>
<p class="listnumber">15.  How would you set the height of row 5 to 100?</p>
<p class="listnumber">16.  How would you hide column C?</p>
<p class="listnumber">17.  What is a freeze pane?</p>
<p class="listnumber">18.  What five functions and methods do you have to call to create a bar chart?</p>
</section>
<section type="division" aria-labelledby="sec27">
<h3 class="h" id="calibre_link-1858"><span id="calibre_link-399"></span><span class="sans_futura_std_bold_b_">Practice Programs</span></h3>
<p class="tni">For practice, write programs to do the following tasks.</p>
<section type="division" aria-labelledby="sec28">
<h4 class="h1" id="calibre_link-1859"><span id="calibre_link-400"></span><span class="sans_futura_std_heavy_oblique_bi_">Multiplication Table Maker</span></h4>
<p class="tni">Create a program <i class="calibre5">multiplicationTable.py</i> that takes a number <i class="calibre5">N</i> from the command line and creates an <i class="calibre5">N</i>×<i class="calibre5">N</i> multiplication table in an Excel spreadsheet. For example, when the program is run like this</p>
<pre class="pre"><code class="calibre9">py multiplicationTable.py 6</code></pre>
<p class="tni">it should create a spreadsheet that looks like Figure 14-10.</p>
<figure class="img"><img class="img2" id="calibre_link-769" src="../assets/automatetheboringstuff.com/3e/images/000018.jpg" alt="An Excel spreadsheet in which cells A2 through A7 contain the numbers 1 through 6, and cells B1 through G1 also contain the values 1 through 6. All other cells show the results of multiplying the value in the row and column." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-10: A multiplication table generated in a spreadsheet</span></p></figcaption>
</figure>
<p class="tx"><span role="doc-pagebreak" type="pagebreak" id="calibre_link-970" aria-label="357"></span>Row 1 and column A should contain labels and be in bold.</p>
</section>
<section type="division" aria-labelledby="sec29">
<h4 class="h1" id="calibre_link-1860"><span id="calibre_link-401"></span><span class="sans_futura_std_heavy_oblique_bi_">Blank Row Inserter</span></h4>
<p class="tni">Create a program <i class="calibre5">blankRowInserter.py</i> that takes two integers and a filename string as command line arguments. Let’s call the first integer <i class="calibre5">N</i> and the second integer <i class="calibre5">M</i>. Starting at row <i class="calibre5">N</i>, the program should insert <i class="calibre5">M</i> blank rows into the spreadsheet. For example, when the program is run like this</p>
<pre class="pre"><code class="calibre9">python blankRowInserter.py 3 2 myProduce.xlsx</code></pre>
<p class="tni">the “before” and “after” spreadsheets should look like Figure 14-11.</p>
<figure class="img"><img class="img1" id="calibre_link-770" src="../assets/automatetheboringstuff.com/3e/images/000019.jpg" alt="Two Excel spreadsheets whose cells contain produce items. In the second spreadsheet, rows three and four are blank, and those rows’ previous contents have been shifted to rows five and six." />
<figcaption><p class="cap"><span class="sans_futura_std_book_oblique_i_">Figure 14-11: Before (left) and after (right) the two blank rows are inserted at row 3</span></p></figcaption>
</figure>
<p class="tx">You can write this program by reading in the contents of the spreadsheet. Then, when writing out the new spreadsheet, use a <span class="thesansmonocd_w5regular_">for</span> loop to copy the first <i class="calibre5">N</i> lines. For the remaining lines, add <i class="calibre5">M</i> to the row number in the output spreadsheet.</p>
</section>
</section>
</section>
</div>


</div>


<style>.atbs-nav{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;justify-content:space-between;margin:1rem 0;padding:.7rem .8rem;border:1px solid #cfd8dc;border-radius:10px;background:#f6fbfd;font:14px/1.35 system-ui,-apple-system,sans-serif;}.atbs-nav-center{color:#455a64;font-weight:600;}.atbs-nav-link{text-decoration:none;color:#0b5b6b;background:#e6f3f7;border:1px solid #c7dfe7;border-radius:7px;padding:.42rem .55rem;display:inline-block;}.atbs-nav-link:hover{background:#d9edf3;}.atbs-nav-disabled{opacity:.55;cursor:not-allowed;}</style><nav class='atbs-nav' aria-label='Chapter pagination'><a class='atbs-nav-link' href='../workbook/chapter13.html' aria-label='Previous chapter'>&larr; Workbook Chapter 13</a><span class='atbs-nav-center'><a class='atbs-nav-link' href='../index.html'>Contents</a> Book Chapter 14</span><a class='atbs-nav-link' href='../workbook/chapter14.html' aria-label='Next chapter'>Workbook Chapter 14 &rarr;</a></nav></body></html>