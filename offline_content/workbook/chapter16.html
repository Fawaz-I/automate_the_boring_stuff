<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="../assets/inventwithpython.com/automate3workbook/style.css" rel="stylesheet" type="text/css" /><title>Automate the Boring Stuff with Python Workbook: Projects and Exercises to Sharpen Your Python Skills</title></head><body><style>.atbs-nav{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;justify-content:space-between;margin:1rem 0;padding:.7rem .8rem;border:1px solid #cfd8dc;border-radius:10px;background:#f6fbfd;font:14px/1.35 system-ui,-apple-system,sans-serif;}.atbs-nav-center{color:#455a64;font-weight:600;}.atbs-nav-link{text-decoration:none;color:#0b5b6b;background:#e6f3f7;border:1px solid #c7dfe7;border-radius:7px;padding:.42rem .55rem;display:inline-block;}.atbs-nav-link:hover{background:#d9edf3;}.atbs-nav-disabled{opacity:.55;cursor:not-allowed;}</style><nav class='atbs-nav' aria-label='Chapter pagination'><a class='atbs-nav-link' href='../book/chapter16.html' aria-label='Previous chapter'>&larr; Book Chapter 16</a><span class='atbs-nav-center'><a class='atbs-nav-link' href='../index.html'>Contents</a> Workbook Chapter 16</span><a class='atbs-nav-link' href='../book/chapter17.html' aria-label='Next chapter'>Book Chapter 17 &rarr;</a></nav>






<div class="calibre" id="calibre_link-24">
<section type="chapter" role="doc-chapter" aria-labelledby="ch16">
<h1 id="calibre_link-2719" type="title" class="h1ch"><span role="doc-pagebreak" id="calibre_link-2720" aria-label="111" class="calibre1"></span><span class="big">16</span><span class="break1"></span>SQLITE DATABASES</h1>
<p class="noindent-c">When your data needs become too complex for a spreadsheet, it’s time to graduate to a database. SQLite, the most widely deployed database software, has powerful features but a simple setup. With a proper grasp of SQLite, you’ll be able to manage any amount of data, whether it’s a few records or gigabytes of information.</p>
<aside type="sidebar" class="sidebar" aria-labelledby="side16" role="doc-example">
<section>
<h2 type="title" class="stitle" id="calibre_link-2721"><img class="inline" src="../assets/inventwithpython.com/automate3workbook/images/000000.jpg" alt="A simple drawing of a light bulb." /> LEARNING OBJECTIVES</h2>
<ul class="b-bullet">
<li class="bull">Understand what databases are and how SQLite compares to other database systems.</li>
<li class="bull">Know how databases organize data with tables, columns, rows, and primary keys.</li>
<li class="bull">Understand SQLite’s system of data types and its type affinity feature.</li>
<li class="bull">Perform CRUD operations to create, read, update, and delete data from databases.</li>
<li class="bull">Back up your SQLite database, even while other programs are actively using it.</li>
<li class="bull"><span role="doc-pagebreak" id="calibre_link-2722" aria-label="112"></span>Store complex data across multiple tables and join them with foreign keys.</li>
<li class="bull">Combine multiple database operations into a single transaction, then roll back operations to cancel the transaction.</li>
</ul>
</section>
</aside>
<section>
<h2 id="calibre_link-197" type="title" class="h"><img class="inline" src="../assets/inventwithpython.com/automate3workbook/images/000005.jpg" alt="A grey circle with a white question mark at the center" /> Practice Questions</h2>
<p class="noindent">These questions test your understanding of how SQLite organizes data into tables and columns, as well as the query language used to interact with the data.</p>
<section>
<h3 id="calibre_link-198" type="title" class="h1">Spreadsheets vs. Databases</h3>
<p class="noindent">In a spreadsheet, rows contain individual records, while columns represent the kind of data stored in the fields of each record. We can store this same information in a database. You can think of a database table as a spreadsheet, and a database can contain one or more tables.</p>
<ol class="order">
<li class="calibre15"><p class="number"><a href="#calibre_link-1017" id="calibre_link-2151" class="calibre6">1</a>. How do you pronounce “SQLite”?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1018" id="calibre_link-2152" class="calibre6">2</a>. What is the database analogue of a spreadsheet sheet?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1019" id="calibre_link-2153" class="calibre6">3</a>. How many tables can be in a database?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1020" id="calibre_link-2154" class="calibre6">4</a>. What is a primary key?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1021" id="calibre_link-2155" class="calibre6">5</a>. By convention, what is the name of the primary key column in SQLite?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1022" id="calibre_link-2156" class="calibre6">6</a>. Does a database record ever change its primary key value?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1023" id="calibre_link-2157" class="calibre6">7</a>. Some spreadsheets have rows of identically structured data, where each column corresponds to a field of data (such as the name, price, or size). But other spreadsheets look like forms, have a fixed size and layout, and enable a human user to fill in the blanks with data. Is the second kind of spreadsheet easy to convert to a database table?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-199" type="title" class="h1">SQLite vs. Other SQL Databases</h3>
<p class="noindent">Like other database software, SQLite uses <i class="calibre5">Structured Query Language (SQL)</i> to read and write massive amounts of data, but it runs within your program and operates in a single file.</p>
<ol class="order">
<li class="calibre15"><p class="number"><a href="#calibre_link-1024" id="calibre_link-2158" class="calibre6">8</a>. Does SQLite run as a server application you must install on your computer?</p></li>
<li class="calibre15"><p class="number"><a href="#calibre_link-1025" id="calibre_link-2159" class="calibre6">9</a>. Does SQLite strictly enforce the data types for its columns?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1026" id="calibre_link-2160" class="calibre6">10</a>. What permissions and user roles does SQLite have?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1027" id="calibre_link-2161" class="calibre6">11</a>. Do you need to pay for permission to use SQLite?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-200" type="title" class="h1"><span role="doc-pagebreak" id="calibre_link-2723" aria-label="113" class="calibre1"></span>Creating Databases and Tables</h3>
<p class="noindent">SQL is a mini-language you can use from within Python, much like regex for regular expressions. Also like regex, we write SQL queries as Python string values. Calling <span class="literal">sqlite3.connect()</span> creates a SQLite database file, and the SQL query <span class="literal">CREATE TABLE SQL</span> creates a table within it. Answer the following questions about databases and tables.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1028" id="calibre_link-2162" class="calibre6">12</a>. What module do you import to use SQLite in Python?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1029" id="calibre_link-2163" class="calibre6">13</a>. After importing the module, what Python instruction connects to a database named, say, <i class="calibre5">example.db</i>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1030" id="calibre_link-2164" class="calibre6">14</a>. What does the <span class="literal">isolation_level=None</span> argument do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1031" id="calibre_link-2165" class="calibre6">15</a>. What does a <span class="literal">CREATE TABLE IF NOT EXISTS</span> query do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1032" id="calibre_link-2166" class="calibre6">16</a>. What are the SQLite data types analogous to Python’s <span class="literal">NoneType</span>, <span class="literal">int</span>, <span class="literal">float</span>, <span class="literal">str</span>, and <span class="literal">bytes</span> data types?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1033" id="calibre_link-2167" class="calibre6">17</a>. If you try to insert the value <span class="literal">'42'</span> into an <span class="literal">INTEGER</span> column, what does SQLite’s type affinity feature do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1034" id="calibre_link-2168" class="calibre6">18</a>. If you try to insert the value <span class="literal">'Hello'</span> into an <span class="literal">INTEGER</span> column, what does SQLite’s type affinity feature do? (Assume strict mode isn’t enabled.)</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1035" id="calibre_link-2169" class="calibre6">19</a>. How do you enable strict mode?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1036" id="calibre_link-2170" class="calibre6">20</a>. Does SQLite have a data type for times and dates?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1037" id="calibre_link-2171" class="calibre6">21</a>. Does SQLite have a data type for Boolean values?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1038" id="calibre_link-2172" class="calibre6">22</a>. What query returns a description of a table’s columns if the table is named, say, <span class="literal">'cats'</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1039" id="calibre_link-2173" class="calibre6">23</a>. How can you list all of the tables in a database?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-201" type="title" class="h1">CRUD Database Operations</h3>
<p class="noindent">CRUD stands for the four basic operations that databases carry out: creating data, reading data, updating data, and deleting data. In SQLite, we perform these operations with <span class="literal">INSERT</span>, <span class="literal">SELECT</span>, <span class="literal">UPDATE</span>, and <span class="literal">DELETE</span> statements, respectively.</p>
<p class="indent">For each operation in questions 24 through 27, state which kind of SQLite query performs it.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1040" id="calibre_link-2174" class="calibre6">24</a>. The “create data” operation</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1041" id="calibre_link-2175" class="calibre6">25</a>. The “read data” operation</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1042" id="calibre_link-2176" class="calibre6">26</a>. The “update data” operation</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1043" id="calibre_link-2177" class="calibre6">27</a>. The “delete data” operation</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1044" id="calibre_link-2178" class="calibre6">28</a>. What is wrong with this query: <span class="literal">'INSERT INTO cats ("Zophie", "2021-01-24", "black", 5.6)'</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1045" id="calibre_link-2179" class="calibre6">29</a>. <span role="doc-pagebreak" id="calibre_link-2724" aria-label="114"></span>Is it possible for an <span class="literal">INSERT</span> query to insert only half of its data into the database?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1046" id="calibre_link-2180" class="calibre6">30</a>. If two Python programs carry out <span class="literal">INSERT</span> queries on the same SQLite database, can one transaction affect the other transaction?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1047" id="calibre_link-2181" class="calibre6">31</a>. What does using <span class="literal">?</span> placeholders instead of f-strings prevent?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1048" id="calibre_link-2182" class="calibre6">32</a>. In the query <span class="literal">'SELECT * FROM cats'</span>, what does <span class="literal">*</span> mean?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1049" id="calibre_link-2183" class="calibre6">33</a>. What is wrong with this query: <span class="literal">'SELECT FROM cats'</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1050" id="calibre_link-2184" class="calibre6">34</a>. What does a <span class="literal">WHERE</span> clause do in a SQLite <span class="literal">SELECT</span> query?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1051" id="calibre_link-2185" class="calibre6">35</a>. What are 10 operators you can use in a <span class="literal">WHERE</span> clause? (Hint: They’re similar to Python’s comparison and Boolean operators.)</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1052" id="calibre_link-2186" class="calibre6">36</a>. What does the <span class="literal">LIKE</span> operator do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1053" id="calibre_link-2187" class="calibre6">37</a>. In the query <span class="literal">'SELECT rowid, name FROM cats'</span>, how could you sort the returned results by <span class="literal">rowid</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1054" id="calibre_link-2188" class="calibre6">38</a>. What does the <span class="literal">LIMIT</span> clause do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1055" id="calibre_link-2189" class="calibre6">39</a>. Does a column index speed up or slow down the process of reading data?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1056" id="calibre_link-2190" class="calibre6">40</a>. Does a column index speed up or slow down the process of inserting or updating data?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1057" id="calibre_link-2191" class="calibre6">41</a>. What Python code returns a list of all of the indexes for a table named <span class="literal">cats</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1058" id="calibre_link-2192" class="calibre6">42</a>. The query <span class="literal">'UPDATE cats SET fur = "black"'</span> lacks a <span class="literal">WHERE</span> clause. What possible bug will this query have?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1059" id="calibre_link-2193" class="calibre6">43</a>. The query <span class="literal">'DELETE FROM cats'</span> lacks a <span class="literal">WHERE</span> clause. What possible bug will this query have?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1060" id="calibre_link-2194" class="calibre6">44</a>. If you ran the following code, what would the second instruction return?</p>
<pre class="calibre16">conn.execute('DELETE FROM staff WHERE rowid = 42')
conn.execute('SELECT * FROM staff WHERE rowid = 42').fetchall()</pre></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1061" id="calibre_link-2195" class="calibre6">45</a>. Run a <span class="literal">SELECT</span> query, but use a table name that doesn’t exist, like <span class="literal">conn.execute('SELECT * FROM does_not_exist').fetchall()</span>. Does this code raise an exception and, if so, what is the error message?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1062" id="calibre_link-2196" class="calibre6">46</a>. Run a <span class="literal">SELECT</span> query but use a <span class="literal">rowid</span> that doesn’t exist, like <span class="literal">conn.execute('SELECT * FROM cats WHERE rowid=9999').fetchall()</span>. Does this code raise an exception and, if so, what is the error message?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-202" type="title" class="h1"><span role="doc-pagebreak" id="calibre_link-2725" aria-label="115" class="calibre1"></span>Rolling Back Transactions</h3>
<p class="noindent">You may sometimes want to run several queries all together, or else not run those queries at all, but you won’t know which you want to do until you’ve run at least some of the queries. One way to handle this situation is to begin a new transaction, execute the queries, and then either commit all of the queries to the database to complete the transaction or roll them back so that the database looks as if none of them were made.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1063" id="calibre_link-2197" class="calibre6">47</a>. What does <span class="literal">conn.execute('BEGIN')</span> do?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1064" id="calibre_link-2198" class="calibre6">48</a>. If you execute multiple <span class="literal">INSERT</span> queries after starting a transaction, when will the data actually be inserted into the database?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1065" id="calibre_link-2199" class="calibre6">49</a>. If you execute multiple <span class="literal">INSERT</span> queries after starting a transaction, what Python code will finish the transaction?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1066" id="calibre_link-2200" class="calibre6">50</a>. After you’ve started a transaction, what Python code will cancel the transaction?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1067" id="calibre_link-2201" class="calibre6">51</a>. Can you roll back a transaction after it has been committed?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-203" type="title" class="h1">Backing Up Databases</h3>
<p class="noindent">If a program isn’t currently accessing the SQLite database, you can back it up by simply copying the database file. If your software is continuously reading or updating the database’s contents, however, you’ll need to use the <span class="literal">Connection</span> object’s <span class="literal">backup()</span> method instead.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1068" id="calibre_link-2202" class="calibre6">52</a>. If no program is currently connected to a SQLite database, what is the easiest way to make a backup?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1069" id="calibre_link-2203" class="calibre6">53</a>. If your program is constantly connected to a SQLite database, what method can make a backup of it in another database file?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1070" id="calibre_link-2204" class="calibre6">54</a>. Assume a variable <span class="literal">conn</span> contains a connection to a database. What code will print the text of the SQLite queries that can re-create this database and its data?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-204" type="title" class="h1">Altering and Dropping Tables</h3>
<p class="noindent">After creating a table in a database and inserting rows into it, you may want to rename the table or its columns. You may also wish to add or delete columns in the table, or even delete the table itself. You can use an <span class="literal">ALTER TABLE</span> query to perform these actions.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1071" id="calibre_link-2205" class="calibre6">55</a>. What query would rename a table from <span class="literal">spam</span> to <span class="literal">eggs</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1072" id="calibre_link-2206" class="calibre6">56</a>. What query would rename a column named <span class="literal">foo</span> to <span class="literal">bar</span> in a table named <span class="literal">spam</span>?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1073" id="calibre_link-2207" class="calibre6">57</a>. <span role="doc-pagebreak" id="calibre_link-2726" aria-label="116"></span>What query would add a new column named <span class="literal">price</span> to a table named <span class="literal">spam</span> and set <span class="literal">price</span> to the value <span class="literal">42</span> for all existing records?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1074" id="calibre_link-2208" class="calibre6">58</a>. What query would delete the entire table named <span class="literal">spam</span>?</p></li>
</ol>
</section>
<section>
<h3 id="calibre_link-205" type="title" class="h1">Joining Multiple Tables with Foreign Keys</h3>
<p class="noindent">The structure of SQLite tables is rather strict; for example, each row has a set number of columns. But real-world data is often more complicated than a single table can capture. In relational databases, we can store complex data across multiple tables, then create links between them called <i class="calibre5">foreign keys</i>.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1075" id="calibre_link-2209" class="calibre6">59</a>. If a foreign key column has the name <span class="literal">cat_id</span>, what can you assume its values represent?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1076" id="calibre_link-2210" class="calibre6">60</a>. A database has two tables, <span class="literal">customers</span> and <span class="literal">orders</span>, to store details about customers, like their names and emails, and details about orders, like the product and date of purchase. Each customer may have purchased multiple orders, while an order may have been purchased by only one customer. Which table should have a foreign key column, and which values should this column contain?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1077" id="calibre_link-2211" class="calibre6">61</a>. Say you have two tables, <span class="literal">cats</span> and <span class="literal">vaccinations</span>, and want to create a foreign key in the <span class="literal">vaccinations</span> table to link it to a cat. What goes into the <span class="literal"><i class="calibre5">ANSWER_GOES_HERE</i></span> part of this code to create the foreign key?</p>
<pre class="calibre16">conn.execute('CREATE TABLE IF NOT EXISTS vaccinations
(vaccine TEXT, date_administered TEXT, administered_by TEXT,
cat_id INTEGER, <span class="codeitalic">ANSWER_GOES_HERE</span>) STRICT')</pre></li>
</ol>
</section>
<section>
<h3 id="calibre_link-206" type="title" class="h1">In-Memory Databases and Backups</h3>
<p class="noindent">If your program makes a large number of queries, you can significantly improve the speed of your database by using an in-memory database. These databases live entirely in the computer’s memory, rather than in a file on the computer’s hard drive, making changes incredibly fast.</p>
<ol class="order">
<li class="calibre15"><p class="number1"><a href="#calibre_link-1078" id="calibre_link-2212" class="calibre6">62</a>. What is the benefit of an in-memory SQLite database?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1079" id="calibre_link-2213" class="calibre6">63</a>. What is the disadvantage of an in-memory SQLite database?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1080" id="calibre_link-2214" class="calibre6">64</a>. Assume you have a <span class="literal">Connection</span> object to an <i class="calibre5">in-memory database</i> in a variable named <span class="literal">memory_db_conn</span>, as well as a <span class="literal">Connection</span> object to a file-based database in a variable named <span class="literal">file_db_conn</span>. What code would save the in-memory database data to the file-based database?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1081" id="calibre_link-2215" class="calibre6">65</a>. If your computer becomes unplugged and the battery dies while your program is updating an in-memory database, how can you recover the database data?</p></li>
<li class="calibre15"><p class="number1"><a href="#calibre_link-1082" id="calibre_link-2216" class="calibre6">66</a>. If your Python program crashes from an unhandled <span class="literal">ZeroDivisionError</span> exception in the following code, will the in-memory database’s data have been saved or lost?</p>
<pre class="calibre16"><span role="doc-pagebreak" id="calibre_link-2727" aria-label="117"></span>import sqlite3
file_db_conn = sqlite3.connect('cats.db', isolation_level=None)
memory_db_conn = sqlite3.connect(':memory:', isolation_level=None)

try:
&nbsp;&nbsp;&nbsp;&nbsp;memory_db_conn.execute('CREATE TABLE cats (name TEXT, fur
TEXT)')
&nbsp;&nbsp;&nbsp;&nbsp;memory_db_conn.execute('INSERT INTO cats VALUES ("Zophie",
"gray")')
&nbsp;&nbsp;&nbsp;&nbsp;spam = 42 / 0&nbsp;&nbsp;# Causes a crash
except:
&nbsp;&nbsp;&nbsp;&nbsp;memory_db_conn.backup(file_db_conn)</pre></li>
</ol>
</section>
</section>
<section>
<h2 id="calibre_link-207" type="title" class="h"><img class="inline" src="../assets/inventwithpython.com/automate3workbook/images/000002.jpg" alt="A simple drawing of a sharpened pencil." /> Practice Projects</h2>
<p class="noindent">In the following projects, you’ll create SQLite databases to monitor disk space and convert databases to text files.</p>
<section>
<h3 id="calibre_link-208" type="title" class="h1">Monitoring Free Disk Space Levels</h3>
<p class="noindent">Let’s use a new module,&nbsp;&nbsp;<span class="literal">psutil</span>, to monitor disk free space with its <span class="literal">psutil.disk_usage()</span> function and store those records in a SQLite database. You can install it by running <span class="literal">pip install psutil</span>. The following code will print the number of bytes of free space if you uncomment the line corresponding to your operating system:</p>
<pre class="pre">import psutil
#print(psutil.disk_usage('C:\\').free)&nbsp;&nbsp;# Windows
#print(psutil.disk_usage('/').free)&nbsp;&nbsp;# macOS and Linux</pre>
<p class="indent">Let’s record how the amount of free space on your computer changes over time. Write a program that creates a SQLite database in a file named <i class="calibre5">monitorFreeSpace.db</i>. This database should have one table named <span class="literal">freespace</span> with two columns: <span class="literal">free</span> (of the <span class="literal">INT</span> data type) and <span class="literal">timestamp</span> (of the <span class="literal">TEXT</span> data type, with the <span class="literal">'YYYY-MM-DD HH:MM:SS.SSS'</span> format). You can get the current time and date as a string by running <span class="literal">import datetime</span> and then calling <span class="literal">str(datetime.datetime.now())</span>.</p>
<p class="indent">Upon starting, the program should create the database and table (if they don’t already exist) and then repeatedly record the amount of free space, with one-second pauses in between recordings. Print the message <span class="literal">"Monitoring disk free space. Press Ctrl-C to quit."</span> at the start of the program, and print the free disk space and timestamp as they’re recorded, to give a visual indication that the program is running and working. The program can run inside an infinite loop, stopping when the user presses <span class="smallcaps">ctrl</span>-C to raise a <span class="literal">KeyboardInterrupt</span> exception.</p>
<p class="indent">Save this program in a file named <i class="calibre5">monitorFreeSpace.py</i>.</p>
<p class="indent">Leave the program running on your computer for an hour or a few days. On your own, run some <span class="literal">SELECT</span> queries to see how the amount of free space has changed over time. The SQLite database can easily handle millions of recordings, and you can write queries that extract the recordings for a particular day or hour.</p>
</section>
<section>
<h3 id="calibre_link-209" type="title" class="h1"><span role="doc-pagebreak" id="calibre_link-2728" aria-label="118" class="calibre1"></span>Database-to-String Converter</h3>
<p class="noindent">Write a program containing a function, <span class="literal">db_to_txt(db_filename)</span>, that takes the filename of a SQLite database, then creates a <i class="calibre5">.txt</i> file with the same name as that SQLite database. For example, given <i class="calibre5">example.db</i>, it should produce an <i class="calibre5">example.db.txt</i> file. The text file should contain all of the information in the database, allowing you to skim the data in a text editor or share it with others who don’t know how to write SQLite queries.</p>
<p class="indent">For the purposes of this exercise, assume that the database always has exactly one table. Your program must find the name of this table, then find the names of every column in this table. The first line of the text file should list the names of the columns separated by commas, and the remaining lines should each list one row from the table. Remember to include the <span class="literal">rowid</span> column’s values.</p>
<p class="indent">You may use the <i class="calibre5">sweigartcats.db</i> database available for download at <i class="calibre5"><a href="https://nostarch.com/automate-boring-stuff-python-3rd-edition" class="calibre6">https://nostarch.com/automate-boring-stuff-python-3rd-edition</a></i> for testing purposes. For example, calling <span class="literal">db_to_txt('sweigartcats.db')</span> would create a file named <i class="calibre5">sweigartcats.db.txt</i> with the following contents:</p>
<pre class="pre">rowid,name,birthdate,fur,weight_kg
1,Zophie,2021-01-24,gray tabby,5.6
2,Miguel,2016-12-24,siamese,6.2
3,Jacob,2022-02-20,orange and white,5.5
4,Gumdrop,2020-08-23,white,6.4
<span class="codeitalic">--snip--</span></pre>
<p class="indent">Save this program in a file named <i class="calibre5">dbToTxt.py</i>.</p>
</section>
</section>
</section>
</div>






<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"8bd877e77db3400e83e36e899a2ab1fd","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<style>.atbs-nav{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;justify-content:space-between;margin:1rem 0;padding:.7rem .8rem;border:1px solid #cfd8dc;border-radius:10px;background:#f6fbfd;font:14px/1.35 system-ui,-apple-system,sans-serif;}.atbs-nav-center{color:#455a64;font-weight:600;}.atbs-nav-link{text-decoration:none;color:#0b5b6b;background:#e6f3f7;border:1px solid #c7dfe7;border-radius:7px;padding:.42rem .55rem;display:inline-block;}.atbs-nav-link:hover{background:#d9edf3;}.atbs-nav-disabled{opacity:.55;cursor:not-allowed;}</style><nav class='atbs-nav' aria-label='Chapter pagination'><a class='atbs-nav-link' href='../book/chapter16.html' aria-label='Previous chapter'>&larr; Book Chapter 16</a><span class='atbs-nav-center'><a class='atbs-nav-link' href='../index.html'>Contents</a> Workbook Chapter 16</span><a class='atbs-nav-link' href='../book/chapter17.html' aria-label='Next chapter'>Book Chapter 17 &rarr;</a></nav></body></html>